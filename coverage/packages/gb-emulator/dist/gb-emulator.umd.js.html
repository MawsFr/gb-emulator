
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for packages/gb-emulator/dist/gb-emulator.umd.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../../index.html">All files</a> / <a href="index.html">packages/gb-emulator/dist</a> gb-emulator.umd.js</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" ><span class="branch-0 cbranch-no" title="branch not covered" >(function(l,S){typeof exports=="object"&amp;&amp;typeof module&lt;"u"?S(exports):typeof define=="function"&amp;&amp;define.amd?define(["exports"],S):(l=typeof globalThis&lt;"u"?globalThis:l||self,S(l["gb-emulator"]={}))})(this,function(l){"use strict";var qr=Object.defineProperty;var Qr=(l,S,d)=&gt;S in l?qr(l,S,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[S]=d;var i=(l,S,d)=&gt;Qr(l,typeof S!="symbol"?S+"":S,d);const S=(s,t,{endianness:e}={endianness:"little"})=&gt;e==="big"?d(at(s),t):d(s,at(t)),d=(s,t)=&gt;s|t,nt=(s,t)=&gt;s^t,_=(s,t)=&gt;s&amp;t,$t={TWO_LAST_DIGITS:255},H=s=&gt;t=&gt;t&gt;&gt;s,C=s=&gt;t=&gt;t&lt;&lt;s,bt=H(8),at=C(8),ot=H(4),B=H(1),V=C(1),Q=s=&gt;bt(s),tt=s=&gt;_(s,$t.TWO_LAST_DIGITS),m=(s,t)=&gt;_(H(t)(s),1),Nt=s=&gt;m(s,0),Mt=s=&gt;m(s,1),Pt=s=&gt;m(s,2),Et=s=&gt;m(s,3),O=({number:s,bitIndex:t,value:e})=&gt;{const r=C(t)(1);return e===1?d(s,r):_(s,nt(r,255))},pt=(s,t)=&gt;O({number:s,bitIndex:0,value:t}),Ht=(s,t)=&gt;O({number:s,bitIndex:1,value:t}),Bt=(s,t)=&gt;O({number:s,bitIndex:2,value:t}),Ot=(s,t)=&gt;O({number:s,bitIndex:3,value:t}),ct=(s,t,{endianness:e}={endianness:"little"})=&gt;m(s,e==="little"?t:7-t)===1,U=s=&gt;`0x${s.toString(16).toUpperCase()}`;class et{constructor(t,e,r){i(this,"name");i(this,"memory");i(this,"PC");this.name=t,this.memory=e,this.PC=r}toString(){return`${this.name} (${U(this.value)})`}}const Z=1,y=2;class ut extends et{constructor(t,e){super("imm8",t,e)}get value(){return this.memory.addresses[this.PC.value+1]}}class ht extends et{constructor(t,e){super("imm16",t,e)}get value(){return S(this.memory.addresses[this.PC.value+1],this.memory.addresses[this.PC.value+2])}}class st{constructor(t,e){i(this,"memory");i(this,"address");this.memory=t,this.address=e}get value(){return _(this.memory.addresses[this.address],255)}set value(t){this.memory.write(this.address,_(t,255))}toString(){return`${U(this.address)} (${U(this.value)})`}}class kt{constructor(){i(this,"_addresses",new Uint8Array(65535))}get addresses(){return this._addresses}write(t,e){this._addresses[t]=_(e,255)}}const lt=16;class gt extends st{}class dt{constructor(t){i(this,"memory");i(this,"tiles");this.memory=t,this.tiles=this.readTiles(),console.log(this.tiles)}readTiles(){const t=[];for(let e=32768;e&lt;=38911;e+=lt)t.push(new gt(this.memory,e));return t}}class Vt{constructor(t){i(this,"memory");i(this,"tileDataTable");this.memory=t,this.tileDataTable=new dt(t),console.log(this.memory,this.tileDataTable)}}class Ut extends st{constructor(t){super(t,65344)}get addressingMode(){return m(this.value,4)}}class rt{constructor(t,e,r){i(this,"name");i(this,"_value",0);i(this,"_mask");this.name=t,this._mask=e,this._value=r??this._value}get value(){return _(this._value,this._mask)}set value(t){this._value=_(t,this._mask)}copyValueInto(t){t.value=this.value}copyValueFrom(t){this.value=t.value}toString(){return`${this.name} (${U(this.value)})`}}class R extends rt{constructor(t){super(t,255)}}class k extends rt{constructor(t,e){super(t,65535,e)}incrementOrDecrementIfNeeded(){}}class _t extends k{constructor(e){super("HLI");i(this,"HL");this.HL=e}get value(){return this.HL.value}set value(e){this.HL.value=e}incrementOrDecrementIfNeeded(){this.HL.value++}}class mt extends k{constructor(e){super("HLD");i(this,"HL");this.HL=e}get value(){return this.HL.value}set value(e){this.HL.value=e}incrementOrDecrementIfNeeded(){this.HL.value--}}class xt extends R{get zeroFlag(){return Nt(this.value)}get halfCarryFlag(){return Pt(this.value)}get subtractionFlag(){return Mt(this.value)}get carryFlag(){return Et(this.value)}set zeroFlag(t){this.value=pt(this.value,t)}set halfCarryFlag(t){this.value=Bt(this.value,t)}set subtractionFlag(t){this.value=Ht(this.value,t)}set carryFlag(t){this.value=Ot(this.value,t)}}class J extends k{constructor(e,r,h){super(e);i(this,"high");i(this,"low");this.high=r,this.low=h}get value(){return _(S(this.high.value,this.low.value,{endianness:"big"}),this._mask)}set value(e){this.high.value=Q(e),this.low.value=tt(e)}}class I{constructor(t,e,r=0){i(this,"name");i(this,"register");i(this,"memory");i(this,"offset");this.name=this.generateName(r,t),this.register=t,this.memory=e,this.offset=r}generateName(t,e){return`[${t?`${t}+${e.name}`:e.name}]`}get value(){return this.memory.addresses[this.offset+this.register.value]}set value(t){this.memory.write(this.offset+this.register.value,t)}copyValueFrom(t){this.value=t.value}copyValueInto(t){t.value=this.value}toString(){return`${this.name} (=&gt; ${U(this.value)})`}}class St extends I{get value(){return this.memory.addresses[this.register.value]}set value(t){this.memory.addresses[this.register.value]=tt(t),this.memory.addresses[this.register.value+1]=Q(t)}}class G{constructor(t,e){i(this,"name");i(this,"flags");this.name=t,this.flags=e}toString(){return`COND ${this.name} (${this.isMet()})`}}class wt extends G{isMet(){return!this.flags.zeroFlag}}class Ft extends G{isMet(){return!!this.flags.zeroFlag}}class At extends G{isMet(){return!this.flags.carryFlag}}class vt extends G{isMet(){return!!this.flags.carryFlag}}class Zt{constructor(t){i(this,"memory");i(this,"A",new R("A"));i(this,"B",new R("B"));i(this,"C",new R("C"));i(this,"D",new R("D"));i(this,"E",new R("E"));i(this,"H",new R("H"));i(this,"L",new R("L"));i(this,"F",new xt("F"));i(this,"HL",new J("HL",this.H,this.L));i(this,"AF",new J("AF",this.A,this.F));i(this,"BC",new J("BC",this.B,this.C));i(this,"DE",new J("DE",this.D,this.E));i(this,"SP",new k("SP",65534));i(this,"PC",new k("PC",256));i(this,"HLI",new _t(this.HL));i(this,"HLD",new mt(this.HL));i(this,"[HL]");i(this,"LCDC");i(this,"r8");i(this,"r16",{0:this.BC,1:this.DE,2:this.HL,3:this.SP});i(this,"r16mem",{0:this.BC,1:this.DE,2:this.HLI,3:this.HLD});i(this,"[r16mem]");i(this,"r16Stk",{0:this.BC,1:this.DE,2:this.HL,3:this.AF});i(this,"conditions",{0:new wt("NZ",this.F),1:new Ft("Z",this.F),2:new At("NC",this.F),3:new vt("C",this.F)});this.memory=t,this.LCDC=new Ut(t),this["[HL]"]=new I(this.HL,t),this.r8={0:this.B,1:this.C,2:this.D,3:this.E,4:this.H,5:this.L,6:this["[HL]"],7:this.A},this["[r16mem]"]={0:new I(this.BC,t),1:new I(this.DE,t),2:new I(this.HLI,t),3:new I(this.HLD,t)}}pushPCToStack(){this.pushToStack(this.PC.value)}popPCFromStack(){this.PC.value=this.popFromStack()}pushToStack(t){this.SP.value--,this.memory.write(this.SP.value,Q(t)),this.SP.value--,this.memory.write(this.SP.value,tt(t))}popFromStack(){const t=this.memory.addresses[this.SP.value];this.SP.value++;const e=this.memory.addresses[this.SP.value];return this.SP.value++,S(t,e)}}const Jt=48,Gt=7,zt=56;class c{constructor(t){i(this,"cpu");i(this,"registers");i(this,"memory");this.cpu=t,this.registers=t.registers,this.memory=t.memory}updateFlagsAfterAddition(t,e,r,h){const g=(h==null?void 0:h.carryFlagBitIndex)??7,x=(h==null?void 0:h.halfCarryFlagBitIndex)??3;this.registers.F.carryFlag=this.getCarryFlag(t,e,g),this.registers.F.halfCarryFlag=this.getCarryFlag(t,e,x),this.registers.F.subtractionFlag=0,h!=null&amp;&amp;h.zeroFlag?this.registers.F.zeroFlag=h.zeroFlag:this.setZeroFlag(r)}getCarryFlag(t,e,r){return ct(t,r)&amp;&amp;ct(e,r)?1:0}updateFlagsAfterSubtraction(t,e,r){this.registers.F.carryFlag=t&lt;e?1:0,this.registers.F.halfCarryFlag=_(t,15)&lt;_(e,15)?1:0,this.registers.F.subtractionFlag=1,this.setZeroFlag(r)}setZeroFlag(t){this.registers.F.zeroFlag=t===0?1:0}updateFlagsAfterRotate(t,e){this.registers.F.subtractionFlag=0,this.registers.F.halfCarryFlag=0,this.registers.F.carryFlag=e,this.setZeroFlag(t)}r8Dest(t){return this.registers.r8[this.extractDestinationR8(t)]}r8Source(t){return this.registers.r8[this.extractSourceR8(t)]}r16(t){return this.registers.r16[this.extractR16(t)]}r16mem(t){return this.registers.r16mem[this.extractR16(t)]}r16Stk(t){return this.registers.r16Stk[this.extractR16(t)]}"[r16mem]"(t){return this.registers["[r16mem]"][this.extractR16(t)]}extractR16(t){return ot(_(t,Jt))}extractDestinationR8(t){return H(3)(_(t,zt))}extractSourceR8(t){return _(t,Gt)}getCondition(t){return H(3)(_(t,24))}condition(t){return this.registers.conditions[this.getCondition(t)]}}class Kt extends c{execute(t){this.r16(t).value=this.cpu.getImmediate16(),this.cpu.goToNextInstruction(y)}toString(t){return`LD ${this.r16(t)}, ${this.cpu.imm16}`}}class jt extends c{execute(t){this.registers.A.copyValueInto(this["[r16mem]"](t)),this.r16mem(t).incrementOrDecrementIfNeeded(),this.cpu.goToNextInstruction()}toString(t){return`LD ${this["[r16mem]"](t)}, ${this.registers.A}`}}class Wt extends c{execute(t){const e=this["[r16mem]"](t);this.registers.A.copyValueFrom(e),this.r16mem(t).incrementOrDecrementIfNeeded(),this.cpu.goToNextInstruction()}toString(t){return`LD ${this.registers.A}, ${this["[r16mem]"](this.extractR16(t))}`}}class Xt extends c{execute(){this.registers.SP.copyValueInto(this.cpu["[imm16]"]),this.cpu.goToNextInstruction(y)}toString(){return`LD ${this.cpu["[imm16]"]}, ${this.registers.SP}`}}class Yt extends c{execute(t){this.r16(t).value++,this.cpu.goToNextInstruction()}toString(t){return`INC ${this.r16(t)}`}}class qt extends c{execute(t){this.r16(t).value--,this.cpu.goToNextInstruction()}toString(t){return`DEC ${this.r16(t)}`}}class Qt extends c{execute(t){const e=this.registers.HL.value,r=this.r16(t).value,h=e+r;this.registers.HL.value=h,this.updateFlagsAfterAddition(e,r,h,{halfCarryFlagBitIndex:11,carryFlagBitIndex:15}),this.cpu.goToNextInstruction()}toString(t){return`ADD ${this.registers.HL}, ${this.r16(t)}`}}class te extends c{execute(t){this.r8Dest(t).value++,this.cpu.goToNextInstruction()}toString(t){return`INC ${this.r8Dest(t)}`}}class ee extends c{execute(t){this.r8Dest(t).value--,this.cpu.goToNextInstruction()}toString(t){return`DEC ${this.r8Dest(t)}`}}class se extends c{execute(t){this.r8Dest(t).value=this.cpu.getImmediate8(),this.cpu.goToNextInstruction(Z)}toString(t){return`LD ${this.r8Dest(t)}, ${this.cpu.imm8}`}}class re extends c{execute(){const t=m(this.registers.A.value,7);this.registers.A.value=d(V(this.registers.A.value),t),this.registers.F.carryFlag=t,this.cpu.goToNextInstruction()}toString(){return"RLCA"}}class ie extends c{execute(){const t=m(this.registers.A.value,0);this.registers.A.value=d(B(this.registers.A.value),C(7)(t)),this.registers.F.carryFlag=t,this.cpu.goToNextInstruction()}toString(){return"RRCA"}}class ne extends c{execute(){const t=this.registers.F.carryFlag,e=m(this.registers.A.value,7);this.registers.A.value=d(V(this.registers.A.value),t),this.registers.F.carryFlag=e,this.cpu.goToNextInstruction()}toString(){return"RLA"}}class ae extends c{execute(){const t=this.registers.F.carryFlag,e=m(this.registers.A.value,0);this.registers.A.value=d(B(this.registers.A.value),C(7)(t)),this.registers.F.carryFlag=e,this.cpu.goToNextInstruction()}toString(){return"RRA"}}class z extends c{execute(){let t=0;const e=this.registers.A.value,r=this.registers.F.halfCarryFlag,h=this.registers.F.carryFlag,x=this.registers.F.subtractionFlag===0;(x&amp;&amp;z.isLeastSignificantNibbleGreaterThan9(e)||r===1)&amp;&amp;(t=d(t,6)),(x&amp;&amp;z.isMostSignificantNibbleGreaterThan9(e)||h===1)&amp;&amp;(t=d(t,96),this.registers.F.carryFlag=1),this.registers.A.value+=x?t:-t,this.setZeroFlag(this.registers.A.value),this.registers.F.halfCarryFlag=0,this.cpu.goToNextInstruction()}static isLeastSignificantNibbleGreaterThan9(t){return _(t,15)&gt;9}static isMostSignificantNibbleGreaterThan9(t){return t&gt;=144}toString(){return"DAA"}}class oe extends c{execute(){this.registers.A.value=~this.registers.A.value,this.registers.F.subtractionFlag=1,this.registers.F.halfCarryFlag=1,this.registers.PC.value++}toString(){return"CPL"}}class ce extends c{execute(){this.registers.F.carryFlag=1,this.registers.F.subtractionFlag=0,this.registers.F.halfCarryFlag=0,this.cpu.goToNextInstruction()}toString(){return"SCF"}}class ue extends c{execute(){this.registers.F.carryFlag=this.registers.F.carryFlag===0?1:0,this.registers.F.subtractionFlag=0,this.registers.F.halfCarryFlag=0,this.cpu.goToNextInstruction()}toString(){return"CCF"}}class he extends c{execute(){this.cpu.goToRelativeAddress(this.cpu.getImmediate8())}toString(){return`JR ${this.cpu.imm8}`}}class le extends c{execute(t){if(!this.condition(t).isMet()){this.cpu.goToNextInstruction(Z);return}this.executeJR_IMM8(t)}executeJR_IMM8(t){this.cpu.instructions[24].execute(t)}toString(t){return`JR ${this.condition(t)}, ${this.cpu.imm8}`}}class ge extends c{execute(){throw new Error("STOP instruction not implemented")}toString(){return"STOP"}}class de extends c{execute(t){this.r8Source(t).copyValueInto(this.r8Dest(t)),this.cpu.goToNextInstruction()}toString(t){return`LD ${this.r8Dest(t)}, ${this.r8Source(t)}`}}class _e extends c{execute(){throw new Error("HALT instruction not implemented")}toString(){return"HALT"}}class T{constructor(t,e){i(this,"register");i(this,"registers");this.register=t,this.registers=e}get(){return this.registers.r8[this.register]}getValue(){return this.registers.r8[this.register].value}getAdditionalBytes(){return 0}}class L{constructor(t){i(this,"cpu");this.cpu=t}get(){return this.cpu.imm8}getValue(){return this.cpu.getImmediate8()}getAdditionalBytes(){return 1}}class It extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.registers.A.value,r=this.source.getValue(),h=e+r;this.registers.A.value=h,this.updateFlagsAfterAddition(e,r,h),this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`ADD ${this.registers.A}, ${this.source.get()}`}}class D extends It{constructor(t,e){super(t,new T(e,t.registers))}}class me extends It{constructor(t){super(t,new L(t))}}class Ct extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.registers.A.value,r=this.source.getValue(),h=this.registers.F.carryFlag,g=e+r+h;this.registers.A.value=g,this.updateFlagsAfterAddition(e,r+h,g),this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`ADC ${this.registers.A}, ${this.source.get()}`}}class f extends Ct{constructor(t,e){super(t,new T(e,t.registers))}}class xe extends Ct{constructor(t){super(t,new L(t))}}class Rt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.registers.A.value,r=this.source.getValue(),h=e-r;this.registers.A.value=h,this.updateFlagsAfterSubtraction(e,r,h),this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`SUB ${this.registers.A}, ${this.source.get()}`}}class $ extends Rt{constructor(t,e){super(t,new T(e,t.registers))}}class Se extends Rt{constructor(t){super(t,new L(t))}}class yt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.registers.A.value,r=this.source.getValue(),h=this.registers.F.carryFlag,g=e-r-h;this.registers.A.value=g,this.updateFlagsAfterSubtraction(e,r-h,g),this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`SBC ${this.registers.A}, ${this.source.get()}`}}class b extends yt{constructor(t,e){super(t,new T(e,t.registers))}}class we extends yt{constructor(t){super(t,new L(t))}}class Tt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.source.getValue();this.registers.A.value=_(this.registers.A.value,e),this.setZeroFlag(this.registers.A.value),this.registers.F.carryFlag=0,this.registers.F.halfCarryFlag=1,this.registers.F.subtractionFlag=0,this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`AND ${this.registers.A}, ${this.source.get()}`}}class N extends Tt{constructor(t,e){super(t,new T(e,t.registers))}}class Fe extends Tt{constructor(t){super(t,new L(t))}}class Lt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.source.getValue();this.registers.A.value=nt(this.registers.A.value,e),this.setZeroFlag(this.registers.A.value),this.registers.F.carryFlag=0,this.registers.F.halfCarryFlag=0,this.registers.F.subtractionFlag=0,this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`XOR ${this.registers.A}, ${this.source.get()}`}}class M extends Lt{constructor(t,e){super(t,new T(e,t.registers))}}class Ae extends Lt{constructor(t){super(t,new L(t))}}class Dt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.source.getValue();this.registers.A.value=d(this.registers.A.value,e),this.setZeroFlag(this.registers.A.value),this.registers.F.carryFlag=0,this.registers.F.halfCarryFlag=0,this.registers.F.subtractionFlag=0,this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`OR ${this.registers.A}, ${this.source.get()}`}}class P extends Dt{constructor(t,e){super(t,new T(e,t.registers))}}class ve extends Dt{constructor(t){super(t,new L(t))}}class ft extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.source.getValue(),r=this.registers.A.value-e;this.updateFlagsAfterSubtraction(this.registers.A.value,e,r),this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`CP ${this.registers.A}, ${this.source.get()}`}}class E extends ft{constructor(t,e){super(t,new T(e,t.registers))}}class Ie extends ft{constructor(t){super(t,new L(t))}}class Ce extends c{execute(){this.registers.popPCFromStack(),this.cpu.goToNextInstruction()}toString(){return"RET"}}class Re extends c{execute(t){if(!this.condition(t).isMet()){this.cpu.goToNextInstruction();return}this.executeRET(t)}executeRET(t){this.cpu.instructions[201].execute(t)}toString(t){return`RET ${this.condition(t)}]`}}class ye extends c{execute(){this.cpu.goToAddress(this.cpu.getImmediate16())}toString(){return`JP ${this.cpu.imm16}`}}class Te extends c{execute(t){if(!this.condition(t).isMet()){this.cpu.goToNextInstruction(y);return}this.executeJP_IMM16(t)}executeJP_IMM16(t){this.cpu.instructions[195].execute(t)}toString(t){return`JP ${this.condition(t)}, ${this.cpu.imm16}`}}class Le extends c{execute(){this.registers.PC.copyValueFrom(this.registers.HL)}toString(){return`JP ${this.registers.HL}`}}class De extends c{execute(){const t=this.cpu.getImmediate16();this.cpu.goToNextInstruction(y),this.registers.pushPCToStack(),this.cpu.goToAddress(t)}toString(){return`CALL ${this.cpu.imm16}`}}class fe extends c{execute(t){if(!this.condition(t).isMet()){this.cpu.goToNextInstruction(y);return}this.executeCALL_IMM16(t)}executeCALL_IMM16(t){this.cpu.instructions[205].execute(t)}toString(t){return`CALL ${this.condition(t)}, ${this.cpu.imm16}`}}class $e extends c{execute(t){this.cpu.goToNextInstruction(),this.registers.pushPCToStack(),this.cpu.goToAddress(this.getRSTAddress(t))}getRSTAddress(t){switch(t){case 199:return 24;case 207:return 32;case 215:return 40;case 223:return 48;case 231:return 56;case 239:return 64;case 247:return 72;case 255:return 80;default:throw new Error(`Unknown opcode: ${t}`)}}toString(t){return`RST ${this.getRSTAddress(t).toString(16)}`}}class be extends c{execute(t){this.r16Stk(t).value=this.registers.popFromStack(),this.cpu.goToNextInstruction()}toString(t){return`POP ${this.r16Stk(t).name}`}}class Ne extends c{execute(t){this.registers.pushToStack(this.r16Stk(t).value),this.cpu.goToNextInstruction()}toString(t){return`PUSH ${this.r16Stk(t).name}`}}class Me extends c{execute(){this.cpu["[FF00+C]"].copyValueFrom(this.registers.A),this.cpu.goToNextInstruction()}toString(){return`LD ${this.cpu["[FF00+C]"]}, ${this.registers.A}`}}class Pe extends c{execute(){this.cpu["[FF00+imm8]"].copyValueFrom(this.registers.A),this.cpu.goToNextInstruction()}toString(){return`LD ${this.cpu["[FF00+imm8]"]}, ${this.registers.A}`}}class Ee extends c{execute(){this.registers.A.copyValueInto(this.cpu["[imm16]"]),this.cpu.goToNextInstruction(y)}toString(){return`LD ${this.cpu["[imm16]"]}, ${this.registers.A}`}}class pe extends c{execute(){this.registers.A.copyValueFrom(this.cpu["[FF00+C]"]),this.cpu.goToNextInstruction()}toString(){return`LD ${this.registers.A}, ${this.cpu["[FF00+C]"]}`}}class He extends c{execute(){this.registers.A.copyValueFrom(this.cpu["[FF00+imm8]"]),this.cpu.goToNextInstruction()}toString(){return`LD ${this.registers.A}, ${this.cpu["[FF00+imm8]"]}`}}class Be extends c{execute(){this.registers.A.copyValueFrom(this.cpu["[imm16]"]),this.cpu.goToNextInstruction(y)}toString(){return`LD ${this.registers.A}, ${this.cpu["[imm16]"]}`}}class Oe extends c{execute(){const t=this.registers.SP.value,e=this.cpu.getImmediate8(),r=t+e;this.registers.SP.value=r,this.updateFlagsAfterAddition(t,e,r,{zeroFlag:0}),this.cpu.goToNextInstruction(Z)}toString(){return`ADD ${this.registers.SP}, ${this.cpu.imm8}`}}class ke extends c{execute(){const t=this.registers.SP.value,e=this.cpu.getImmediate8(),r=t+e;this.registers.HL.value=r,this.updateFlagsAfterAddition(t,e,r,{zeroFlag:0}),this.cpu.goToNextInstruction(Z)}toString(){return`LD ${this.registers.HL}, ${this.registers.SP} + ${this.cpu.imm8}`}}class Ve extends c{execute(){this.registers.SP.copyValueFrom(this.registers.HL),this.cpu.goToNextInstruction()}toString(){return`LD ${this.registers.SP}, ${this.registers.HL}`}}class Ue extends c{execute(){throw new Error("Not implemented")}toString(){return"RETI"}}class Ze extends c{execute(){throw new Error("Not implemented")}toString(){return"EI"}}class Je extends c{execute(){throw new Error("Not implemented")}toString(){return"DI"}}class Ge extends c{execute(){this.cpu.hardLock()}toString(){return"âš  HARD_LOCK"}}class ze extends c{execute(t){const e=this.r8Source(t),r=m(e.value,7);e.value=d(V(e.value),r),this.updateFlagsAfterRotate(e.value,r),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) RLC ${this.r8Source(t).name}`}}class Ke extends c{execute(t){const e=this.r8Source(t),r=m(e.value,0);e.value=d(B(e.value),C(7)(r)),this.updateFlagsAfterRotate(e.value,r),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) RRC ${this.r8Source(t).name}`}}class je extends c{execute(t){const e=this.r8Source(t),r=this.registers.F.carryFlag,h=m(e.value,0);e.value=d(B(e.value),C(7)(r)),this.registers.F.carryFlag=h,this.cpu.goToNextInstruction()}toString(t){return`(prefixed) RR ${this.r8Source(t).name}`}}class We extends c{execute(t){const e=this.r8Source(t),r=this.registers.F.carryFlag,h=m(e.value,7);e.value=d(V(e.value),r),this.registers.F.carryFlag=h,this.cpu.goToNextInstruction()}toString(t){return`(prefixed) RL ${this.r8Source(t).name}`}}class Xe extends c{execute(t){const e=this.r8Source(t),r=m(e.value,7);e.value=V(e.value),this.updateFlagsAfterRotate(e.value,r),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) SLA ${this.r8Source(t).name}`}}class Ye extends c{execute(t){const e=this.r8Source(t),r=m(e.value,0),h=m(e.value,7);e.value=B(e.value),e.value=d(e.value,C(7)(h)),this.updateFlagsAfterRotate(e.value,r),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) SRA ${this.r8Source(t).name}`}}class qe extends c{execute(t){const e=this.r8Source(t),{value:r}=e;e.value=d(C(4)(_(r,15)),ot(_(r,240))),this.updateFlagsAfterRotate(e.value,0),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) SWAP ${this.r8Source(t).name}`}}class Qe extends c{execute(t){const e=this.r8Source(t),r=m(e.value,0);e.value=B(e.value),this.updateFlagsAfterRotate(e.value,r),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) SRL ${this.r8Source(t).name}`}}class ts extends c{execute(t){const e=this.extractDestinationR8(t);this.registers.F.halfCarryFlag=1,this.registers.F.subtractionFlag=0,this.registers.F.zeroFlag=m(this.r8Source(t).value,e),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) BIT ${this.extractDestinationR8(t)}, ${this.r8Source(t)}`}}class es extends c{execute(t){const e=this.r8Source(t),r=this.extractDestinationR8(t);e.value=O({number:e.value,bitIndex:r,value:0}),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) RES ${this.extractDestinationR8(t)}, ${this.r8Source(t).name}`}}class ss extends c{execute(t){const e=this.r8Source(t),r=this.extractDestinationR8(t);e.value=O({number:e.value,bitIndex:r,value:1}),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) SET ${this.extractDestinationR8(t)}, ${this.r8Source(t).name}`}}class rs extends c{execute(){this.cpu.goToNextInstruction();const t=this.cpu.decodePrefixed(this.memory.addresses[this.registers.PC.value]);this.cpu.executePrefixed(t)}toString(){return"CB (prefixed)"}}class is extends c{execute(){this.cpu.goToNextInstruction()}toString(){return"NOP"}}class it{static loadPrefixedInstructions(t){const e=new ze(t),r=new Ke(t),h=new We(t),g=new je(t),x=new Xe(t),w=new Ye(t),F=new qe(t),A=new Qe(t),n=new ts(t),a=new es(t),o=new ss(t);return{0:e,1:e,2:e,3:e,4:e,5:e,6:e,7:e,8:r,9:r,10:r,11:r,12:r,13:r,14:r,15:r,16:h,17:h,18:h,19:h,20:h,21:h,22:h,23:h,24:g,25:g,26:g,27:g,28:g,29:g,30:g,31:g,32:x,33:x,34:x,35:x,36:x,37:x,38:x,39:x,40:w,41:w,42:w,43:w,44:w,45:w,46:w,47:w,48:F,49:F,50:F,51:F,52:F,53:F,54:F,55:F,56:A,57:A,58:A,59:A,60:A,61:A,62:A,63:A,64:n,72:n,80:n,88:n,96:n,104:n,112:n,120:n,65:n,73:n,81:n,89:n,97:n,105:n,113:n,121:n,66:n,74:n,82:n,90:n,98:n,106:n,114:n,122:n,67:n,75:n,83:n,91:n,99:n,107:n,115:n,123:n,68:n,76:n,84:n,92:n,100:n,108:n,116:n,124:n,69:n,77:n,85:n,93:n,101:n,109:n,117:n,125:n,70:n,78:n,86:n,94:n,102:n,110:n,118:n,126:n,71:n,79:n,87:n,95:n,103:n,111:n,119:n,127:n,128:a,136:a,144:a,152:a,160:a,168:a,176:a,184:a,129:a,137:a,145:a,153:a,161:a,169:a,177:a,185:a,130:a,138:a,146:a,154:a,162:a,170:a,178:a,186:a,131:a,139:a,147:a,155:a,163:a,171:a,179:a,187:a,132:a,140:a,148:a,156:a,164:a,172:a,180:a,188:a,133:a,141:a,149:a,157:a,165:a,173:a,181:a,189:a,134:a,142:a,150:a,158:a,166:a,174:a,182:a,190:a,135:a,143:a,151:a,159:a,167:a,175:a,183:a,191:a,192:o,200:o,208:o,216:o,224:o,232:o,240:o,248:o,193:o,201:o,209:o,217:o,225:o,233:o,241:o,249:o,194:o,202:o,210:o,218:o,226:o,234:o,242:o,250:o,195:o,203:o,211:o,219:o,227:o,235:o,243:o,251:o,196:o,204:o,212:o,220:o,228:o,236:o,244:o,252:o,197:o,205:o,213:o,221:o,229:o,237:o,245:o,253:o,198:o,206:o,214:o,222:o,230:o,238:o,246:o,254:o,199:o,207:o,215:o,223:o,231:o,239:o,247:o,255:o}}}i(it,"loadInstructions",t=&gt;{const e=new is(t),r=new Kt(t),h=new jt(t),g=new Wt(t),x=new Xt(t),w=new Yt(t),F=new qt(t),A=new Qt(t),n=new te(t),a=new ee(t),o=new se(t),as=new re(t),os=new ie(t),cs=new ne(t),us=new ae(t),hs=new z(t),ls=new oe(t),gs=new ce(t),ds=new ue(t),_s=new he(t),K=new le(t),ms=new ge(t),xs=new _e(t),u=new de(t),Ss=new D(t,0),ws=new D(t,1),Fs=new D(t,2),As=new D(t,3),vs=new D(t,4),Is=new D(t,5),Cs=new D(t,6),Rs=new D(t,7),ys=new me(t),Ts=new f(t,0),Ls=new f(t,1),Ds=new f(t,2),fs=new f(t,3),$s=new f(t,4),bs=new f(t,5),Ns=new f(t,6),Ms=new f(t,7),Ps=new xe(t),Es=new $(t,0),ps=new $(t,1),Hs=new $(t,2),Bs=new $(t,3),Os=new $(t,4),ks=new $(t,5),Vs=new $(t,6),Us=new $(t,7),Zs=new Se(t),Js=new b(t,0),Gs=new b(t,1),zs=new b(t,2),Ks=new b(t,3),js=new b(t,4),Ws=new b(t,5),Xs=new b(t,6),Ys=new b(t,7),qs=new we(t),Qs=new N(t,0),tr=new N(t,1),er=new N(t,2),sr=new N(t,3),rr=new N(t,4),ir=new N(t,5),nr=new N(t,6),ar=new N(t,7),or=new Fe(t),cr=new M(t,0),ur=new M(t,1),hr=new M(t,2),lr=new M(t,3),gr=new M(t,4),dr=new M(t,5),_r=new M(t,6),mr=new M(t,7),xr=new Ae(t),Sr=new P(t,0),wr=new P(t,1),Fr=new P(t,2),Ar=new P(t,3),vr=new P(t,4),Ir=new P(t,5),Cr=new P(t,6),Rr=new P(t,7),yr=new ve(t),Tr=new E(t,0),Lr=new E(t,1),Dr=new E(t,2),fr=new E(t,3),$r=new E(t,4),br=new E(t,5),Nr=new E(t,6),Mr=new E(t,7),Pr=new Ie(t),j=new Re(t),Er=new Ce(t),pr=new Ue(t),Hr=new ye(t),W=new Te(t),Br=new Le(t),Or=new De(t),X=new fe(t),p=new $e(t),Y=new be(t),q=new Ne(t),kr=new Me(t),Vr=new Pe(t),Ur=new Ee(t),Zr=new pe(t),Jr=new He(t),Gr=new Be(t),zr=new Oe(t),Kr=new ke(t),jr=new Ve(t),Wr=new Ze(t),Xr=new Je(t),v=new Ge(t),Yr=new rs(t);return{0:e,1:r,17:r,33:r,49:r,2:h,18:h,34:h,50:h,10:g,26:g,42:g,58:g,8:x,3:w,19:w,35:w,51:w,11:F,27:F,43:F,59:F,9:A,25:A,41:A,57:A,4:n,12:n,20:n,28:n,36:n,44:n,52:n,60:n,5:a,13:a,21:a,29:a,37:a,45:a,53:a,61:a,6:o,14:o,22:o,30:o,38:o,46:o,54:o,62:o,7:as,15:os,23:cs,31:us,39:hs,47:ls,55:gs,63:ds,24:_s,32:K,40:K,48:K,56:K,16:ms,118:xs,64:u,72:u,80:u,88:u,96:u,104:u,112:u,120:u,65:u,73:u,81:u,89:u,97:u,105:u,113:u,121:u,66:u,74:u,82:u,90:u,98:u,106:u,114:u,122:u,67:u,75:u,83:u,91:u,99:u,107:u,115:u,123:u,68:u,76:u,84:u,92:u,100:u,108:u,116:u,124:u,69:u,77:u,85:u,93:u,101:u,109:u,117:u,125:u,70:u,78:u,86:u,94:u,102:u,110:u,126:u,71:u,79:u,87:u,95:u,103:u,111:u,119:u,127:u,128:Ss,129:ws,130:Fs,131:As,132:vs,133:Is,134:Cs,135:Rs,198:ys,136:Ts,137:Ls,138:Ds,139:fs,140:$s,141:bs,142:Ns,143:Ms,206:Ps,144:Es,145:ps,146:Hs,147:Bs,148:Os,149:ks,150:Vs,151:Us,214:Zs,152:Js,153:Gs,154:zs,155:Ks,156:js,157:Ws,158:Xs,159:Ys,222:qs,160:Qs,161:tr,162:er,163:sr,164:rr,165:ir,166:nr,167:ar,230:or,168:cr,169:ur,170:hr,171:lr,172:gr,173:dr,174:_r,175:mr,238:xr,176:Sr,177:wr,178:Fr,179:Ar,180:vr,181:Ir,182:Cr,183:Rr,246:yr,184:Tr,185:Lr,186:Dr,187:fr,188:$r,189:br,190:Nr,191:Mr,254:Pr,192:j,200:j,208:j,216:j,201:Er,217:pr,195:Hr,194:W,202:W,210:W,218:W,233:Br,205:Or,196:X,204:X,212:X,220:X,199:p,207:p,215:p,223:p,231:p,239:p,247:p,255:p,193:Y,209:Y,225:Y,241:Y,197:q,213:q,229:q,245:q,226:kr,224:Vr,234:Ur,242:Zr,240:Jr,250:Gr,232:zr,248:Kr,249:jr,251:Wr,243:Xr,211:v,219:v,221:v,227:v,228:v,235:v,236:v,237:v,244:v,252:v,253:v,203:Yr}});class ns{constructor(t){i(this,"registers");i(this,"memory");i(this,"instructions");i(this,"prefixedInstructions");i(this,"hardLocked",!1);i(this,"imm8");i(this,"imm16");i(this,"[imm8]");i(this,"[imm16]");i(this,"[FF00+C]");i(this,"[FF00+imm8]");this.registers=t.registers,this.memory=t.memory,this.imm8=new ut(this.memory,this.registers.PC),this.imm16=new ht(this.memory,this.registers.PC),this["[imm8]"]=new I(this.imm8,this.memory),this["[imm16]"]=new St(this.imm16,this.memory),this["[FF00+C]"]=new I(this.registers.C,this.memory,65280),this["[FF00+imm8]"]=new I(this.imm8,this.memory,65280),this.instructions=it.loadInstructions(this),this.prefixedInstructions=it.loadPrefixedInstructions(this)}getImmediate8(){return this.imm8.value}getImmediate16(){return this.imm16.value}getCurrentAddress(){return this.registers.PC.value}goToAddress(t){this.registers.PC.value=t}goToRelativeAddress(t){this.registers.PC.value+=t}goToNextInstruction(t=0){this.goToRelativeAddress(1+t)}execute(t){this.instructions[t].execute(t)}executePrefixed(t){this.prefixedInstructions[t].execute(t)}hardLock(){this.hardLocked=!0}isHardLocked(){return this.hardLocked}loadROM(t){for(const[e,r]of[...t].entries())this.memory.write(e,r)}startDispatchLoop(){setInterval(()=&gt;{this.dispatch()},1e3/60)}dispatch(){const t=this.decode(this.fetchNextByte()),e=this.instructions[t];return console.log(`Executing opcode : ${t.toString(16).toUpperCase()} | ${t.toString(2)} | ${e.toString(t)}`),e.execute(t),e}fetchNextByte(){const t=this.memory.addresses[this.registers.PC.value];return console.log(`Fetching byte : ${t.toString(16).toUpperCase()} | ${t.toString(2)}`),t}decode(t){const e=t;if(!this.isValidOpcode(e))throw new Error(`Unknown instruction ${e.toString(16).toUpperCase()} | ${e.toString(2)}`);return e}isValidOpcode(t){return this.instructions[t]}decodePrefixed(t){const e=t;if(!Object.keys(this.prefixedInstructions).includes(String(e)))throw new Error("Unknown prefixed instruction");return e}}l.AbstractRegister=rt,l.C=vt,l.ComposedRegister=J,l.Condition=G,l.Cpu=ns,l.Graphics=Vt,l.HLD=mt,l.HLI=_t,l.Immediate16=ht,l.Immediate8=ut,l.ImmediateMemoryValue=et,l.Instruction=c,l.Memory=kt,l.Memory8Value=st,l.NC=At,l.NZ=wt,l.OperationFlags=xt,l.Pointer=I,l.Pointer16=St,l.Register16=k,l.Register8=R,l.Registers=Zt,l.SKIP_IMMEDIATE_16=y,l.SKIP_IMMEDIATE_8=Z,l.TILE_DATA_BYTE_SIZE=lt,l.TileData=gt,l.TileDataTable=dt,l.Z=Ft,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})}</span></span>);</span>
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-03-02T16:02:03.960Z
            </div>
        <script src="../../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../../sorter.js"></script>
        <script src="../../../block-navigation.js"></script>
    </body>
</html>
    