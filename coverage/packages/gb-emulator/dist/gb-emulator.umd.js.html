
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for packages/gb-emulator/dist/gb-emulator.umd.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../../index.html">All files</a> / <a href="index.html">packages/gb-emulator/dist</a> gb-emulator.umd.js</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" ><span class="branch-0 cbranch-no" title="branch not covered" >(function(l,w){typeof exports=="object"&amp;&amp;typeof module&lt;"u"?w(exports):typeof define=="function"&amp;&amp;define.amd?define(["exports"],w):(l=typeof globalThis&lt;"u"?globalThis:l||self,w(l["gb-emulator"]={}))})(this,function(l){"use strict";var ti=Object.defineProperty;var ei=(l,w,d)=&gt;w in l?ti(l,w,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[w]=d;var i=(l,w,d)=&gt;ei(l,typeof w!="symbol"?w+"":w,d);const w=(s,t,{endianness:e}={endianness:"little"})=&gt;e==="big"?d(ct(s),t):d(s,ct(t)),d=(s,t)=&gt;s|t,at=(s,t)=&gt;s^t,m=(s,t)=&gt;s&amp;t,Nt={TWO_LAST_DIGITS:255},H=s=&gt;t=&gt;t&gt;&gt;s,v=s=&gt;t=&gt;t&lt;&lt;s,Mt=H(8),ct=v(8),ut=H(4),B=H(1),V=v(1),tt=s=&gt;Mt(s),et=s=&gt;m(s,Nt.TWO_LAST_DIGITS),_=(s,t,e={endianness:"little"})=&gt;m(H(e.endianness==="big"?7-t:t)(s),1),Pt=s=&gt;_(s,0),Et=s=&gt;_(s,1),pt=s=&gt;_(s,2),Ht=s=&gt;_(s,3),O=({number:s,bitIndex:t,value:e})=&gt;{const r=v(t)(1);return e===1?d(s,r):m(s,at(r,255))},Bt=(s,t)=&gt;O({number:s,bitIndex:0,value:t}),Ot=(s,t)=&gt;O({number:s,bitIndex:1,value:t}),kt=(s,t)=&gt;O({number:s,bitIndex:2,value:t}),Vt=(s,t)=&gt;O({number:s,bitIndex:3,value:t}),ht=(s,t,e={endianness:"little"})=&gt;_(s,t,e)===1,U=s=&gt;`0x${s.toString(16).toUpperCase()}`;class st{constructor(t,e,r){i(this,"name");i(this,"memory");i(this,"PC");this.name=t,this.memory=e,this.PC=r}toString(){return`${this.name} (${U(this.value)})`}}const Z=1,R=2;class lt extends st{constructor(t,e){super("imm8",t,e)}get value(){return this.memory.addresses[this.PC.value+1]}}class gt extends st{constructor(t,e){super("imm16",t,e)}get value(){return w(this.memory.addresses[this.PC.value+1],this.memory.addresses[this.PC.value+2])}}class rt{constructor(t,e){i(this,"memory");i(this,"address");this.memory=t,this.address=e}get value(){return m(this.memory.addresses[this.address],255)}set value(t){this.memory.write(this.address,m(t,255))}toString(){return`${U(this.address)} (${U(this.value)})`}}class Ut{constructor(){i(this,"addresses",new Uint8Array(65535))}write(t,e){this.addresses[t]=m(e,255)}}const it=16,z=8,dt=2;class _t extends rt{constructor(e,r,h){super(e,r);i(this,"lines",[]);i(this,"height");this.height=(h==null?void 0:h.height)??it,this.lines=this.readBytes()}readBytes(){const e=[];for(let r=this.address;r&lt;this.address+this.height;r+=dt){const h=this.memory.addresses[r],g=this.memory.addresses[r+1],x=[];for(let S=0;S&lt;z;S++){const A=_(h,S,{endianness:"big"}),F=_(g,S,{endianness:"big"}),n=d(v(1)(F),A);x.push(n)}e.push(x)}return e}}class mt{constructor(t,e){i(this,"graphics");i(this,"memory");i(this,"tiles");this.graphics=t,this.memory=e,this.tiles=this.readTiles()}readTiles(){const t=[];for(let e=32768;e&lt;=38911;e+=it)t.push(new _t(this.memory,e));return t}render(t){for(const[e,r]of this.tiles.entries()){const h={x:e%16*z,y:Math.floor(e/16)*z};t.drawTile(r,h,this.graphics.palettes.BGP)}}}class Zt{constructor(t){i(this,"memory");i(this,"tileDataTable");i(this,"palettes",{BGP:{0:[255,255,255,1],1:[192,192,192,1],2:[96,96,96,1],3:[0,0,0,1]}});this.memory=t,this.tileDataTable=new mt(this,this.memory)}render(){throw new Error("Method not implemented.")}}class Gt extends rt{constructor(t){super(t,65344)}get addressingMode(){return _(this.value,4)}}class nt{constructor(t,e,r){i(this,"name");i(this,"_value",0);i(this,"_mask");this.name=t,this._mask=e,this._value=r??this._value}get value(){return m(this._value,this._mask)}set value(t){this._value=m(t,this._mask)}copyValueInto(t){t.value=this.value}copyValueFrom(t){this.value=t.value}toString(){return`${this.name} (${U(this.value)})`}}class C extends nt{constructor(t){super(t,255)}}class k extends nt{constructor(t,e){super(t,65535,e)}incrementOrDecrementIfNeeded(){}}class xt extends k{constructor(e){super("HLI");i(this,"HL");this.HL=e}get value(){return this.HL.value}set value(e){this.HL.value=e}incrementOrDecrementIfNeeded(){this.HL.value++}}class St extends k{constructor(e){super("HLD");i(this,"HL");this.HL=e}get value(){return this.HL.value}set value(e){this.HL.value=e}incrementOrDecrementIfNeeded(){this.HL.value--}}class wt extends C{get zeroFlag(){return Pt(this.value)}get halfCarryFlag(){return pt(this.value)}get subtractionFlag(){return Et(this.value)}get carryFlag(){return Ht(this.value)}set zeroFlag(t){this.value=Bt(this.value,t)}set halfCarryFlag(t){this.value=kt(this.value,t)}set subtractionFlag(t){this.value=Ot(this.value,t)}set carryFlag(t){this.value=Vt(this.value,t)}}class G extends k{constructor(e,r,h){super(e);i(this,"high");i(this,"low");this.high=r,this.low=h}get value(){return m(w(this.high.value,this.low.value,{endianness:"big"}),this._mask)}set value(e){this.high.value=tt(e),this.low.value=et(e)}}class y{constructor(t,e,r=0){i(this,"name");i(this,"register");i(this,"memory");i(this,"offset");this.name=this.generateName(r,t),this.register=t,this.memory=e,this.offset=r}generateName(t,e){return`[${t?`${t}+${e.name}`:e.name}]`}get value(){return this.memory.addresses[this.offset+this.register.value]}set value(t){this.memory.write(this.offset+this.register.value,t)}copyValueFrom(t){this.value=t.value}copyValueInto(t){t.value=this.value}toString(){return`${this.name} (=&gt; ${U(this.value)})`}}class At extends y{get value(){return this.memory.addresses[this.register.value]}set value(t){this.memory.addresses[this.register.value]=et(t),this.memory.addresses[this.register.value+1]=tt(t)}}class J{constructor(t,e){i(this,"name");i(this,"flags");this.name=t,this.flags=e}toString(){return`COND ${this.name} (${this.isMet()})`}}class Ft extends J{isMet(){return!this.flags.zeroFlag}}class It extends J{isMet(){return!!this.flags.zeroFlag}}class vt extends J{isMet(){return!this.flags.carryFlag}}class yt extends J{isMet(){return!!this.flags.carryFlag}}class Jt{constructor(t){i(this,"memory");i(this,"A",new C("A"));i(this,"B",new C("B"));i(this,"C",new C("C"));i(this,"D",new C("D"));i(this,"E",new C("E"));i(this,"H",new C("H"));i(this,"L",new C("L"));i(this,"F",new wt("F"));i(this,"HL",new G("HL",this.H,this.L));i(this,"AF",new G("AF",this.A,this.F));i(this,"BC",new G("BC",this.B,this.C));i(this,"DE",new G("DE",this.D,this.E));i(this,"SP",new k("SP",65534));i(this,"PC",new k("PC",256));i(this,"HLI",new xt(this.HL));i(this,"HLD",new St(this.HL));i(this,"[HL]");i(this,"LCDC");i(this,"r8");i(this,"r16",{0:this.BC,1:this.DE,2:this.HL,3:this.SP});i(this,"r16mem",{0:this.BC,1:this.DE,2:this.HLI,3:this.HLD});i(this,"[r16mem]");i(this,"r16Stk",{0:this.BC,1:this.DE,2:this.HL,3:this.AF});i(this,"conditions",{0:new Ft("NZ",this.F),1:new It("Z",this.F),2:new vt("NC",this.F),3:new yt("C",this.F)});this.memory=t,this.LCDC=new Gt(t),this["[HL]"]=new y(this.HL,t),this.r8={0:this.B,1:this.C,2:this.D,3:this.E,4:this.H,5:this.L,6:this["[HL]"],7:this.A},this["[r16mem]"]={0:new y(this.BC,t),1:new y(this.DE,t),2:new y(this.HLI,t),3:new y(this.HLD,t)}}pushPCToStack(){this.pushToStack(this.PC.value)}popPCFromStack(){this.PC.value=this.popFromStack()}pushToStack(t){this.SP.value--,this.memory.write(this.SP.value,tt(t)),this.SP.value--,this.memory.write(this.SP.value,et(t))}popFromStack(){const t=this.memory.addresses[this.SP.value];this.SP.value++;const e=this.memory.addresses[this.SP.value];return this.SP.value++,w(t,e)}}const zt=48,Kt=7,jt=56;class c{constructor(t){i(this,"cpu");i(this,"registers");i(this,"memory");this.cpu=t,this.registers=t.registers,this.memory=t.memory}updateFlagsAfterAddition(t,e,r,h){const g=(h==null?void 0:h.carryFlagBitIndex)??7,x=(h==null?void 0:h.halfCarryFlagBitIndex)??3;this.registers.F.carryFlag=this.getCarryFlag(t,e,g),this.registers.F.halfCarryFlag=this.getCarryFlag(t,e,x),this.registers.F.subtractionFlag=0,h!=null&amp;&amp;h.zeroFlag?this.registers.F.zeroFlag=h.zeroFlag:this.setZeroFlag(r)}getCarryFlag(t,e,r){return ht(t,r)&amp;&amp;ht(e,r)?1:0}updateFlagsAfterSubtraction(t,e,r){this.registers.F.carryFlag=t&lt;e?1:0,this.registers.F.halfCarryFlag=m(t,15)&lt;m(e,15)?1:0,this.registers.F.subtractionFlag=1,this.setZeroFlag(r)}setZeroFlag(t){this.registers.F.zeroFlag=t===0?1:0}updateFlagsAfterRotate(t,e){this.registers.F.subtractionFlag=0,this.registers.F.halfCarryFlag=0,this.registers.F.carryFlag=e,this.setZeroFlag(t)}r8Dest(t){return this.registers.r8[this.extractDestinationR8(t)]}r8Source(t){return this.registers.r8[this.extractSourceR8(t)]}r16(t){return this.registers.r16[this.extractR16(t)]}r16mem(t){return this.registers.r16mem[this.extractR16(t)]}r16Stk(t){return this.registers.r16Stk[this.extractR16(t)]}"[r16mem]"(t){return this.registers["[r16mem]"][this.extractR16(t)]}extractR16(t){return ut(m(t,zt))}extractDestinationR8(t){return H(3)(m(t,jt))}extractSourceR8(t){return m(t,Kt)}getCondition(t){return H(3)(m(t,24))}condition(t){return this.registers.conditions[this.getCondition(t)]}}class Wt extends c{execute(t){this.r16(t).value=this.cpu.getImmediate16(),this.cpu.goToNextInstruction(R)}toString(t){return`LD ${this.r16(t)}, ${this.cpu.imm16}`}}class Xt extends c{execute(t){this.registers.A.copyValueInto(this["[r16mem]"](t)),this.r16mem(t).incrementOrDecrementIfNeeded(),this.cpu.goToNextInstruction()}toString(t){return`LD ${this["[r16mem]"](t)}, ${this.registers.A}`}}class Yt extends c{execute(t){const e=this["[r16mem]"](t);this.registers.A.copyValueFrom(e),this.r16mem(t).incrementOrDecrementIfNeeded(),this.cpu.goToNextInstruction()}toString(t){return`LD ${this.registers.A}, ${this["[r16mem]"](this.extractR16(t))}`}}class qt extends c{execute(){this.registers.SP.copyValueInto(this.cpu["[imm16]"]),this.cpu.goToNextInstruction(R)}toString(){return`LD ${this.cpu["[imm16]"]}, ${this.registers.SP}`}}class Qt extends c{execute(t){this.r16(t).value++,this.cpu.goToNextInstruction()}toString(t){return`INC ${this.r16(t)}`}}class te extends c{execute(t){this.r16(t).value--,this.cpu.goToNextInstruction()}toString(t){return`DEC ${this.r16(t)}`}}class ee extends c{execute(t){const e=this.registers.HL.value,r=this.r16(t).value,h=e+r;this.registers.HL.value=h,this.updateFlagsAfterAddition(e,r,h,{halfCarryFlagBitIndex:11,carryFlagBitIndex:15}),this.cpu.goToNextInstruction()}toString(t){return`ADD ${this.registers.HL}, ${this.r16(t)}`}}class se extends c{execute(t){this.r8Dest(t).value++,this.cpu.goToNextInstruction()}toString(t){return`INC ${this.r8Dest(t)}`}}class re extends c{execute(t){this.r8Dest(t).value--,this.cpu.goToNextInstruction()}toString(t){return`DEC ${this.r8Dest(t)}`}}class ie extends c{execute(t){this.r8Dest(t).value=this.cpu.getImmediate8(),this.cpu.goToNextInstruction(Z)}toString(t){return`LD ${this.r8Dest(t)}, ${this.cpu.imm8}`}}class ne extends c{execute(){const t=_(this.registers.A.value,7);this.registers.A.value=d(V(this.registers.A.value),t),this.registers.F.carryFlag=t,this.cpu.goToNextInstruction()}toString(){return"RLCA"}}class oe extends c{execute(){const t=_(this.registers.A.value,0);this.registers.A.value=d(B(this.registers.A.value),v(7)(t)),this.registers.F.carryFlag=t,this.cpu.goToNextInstruction()}toString(){return"RRCA"}}class ae extends c{execute(){const t=this.registers.F.carryFlag,e=_(this.registers.A.value,7);this.registers.A.value=d(V(this.registers.A.value),t),this.registers.F.carryFlag=e,this.cpu.goToNextInstruction()}toString(){return"RLA"}}class ce extends c{execute(){const t=this.registers.F.carryFlag,e=_(this.registers.A.value,0);this.registers.A.value=d(B(this.registers.A.value),v(7)(t)),this.registers.F.carryFlag=e,this.cpu.goToNextInstruction()}toString(){return"RRA"}}class K extends c{execute(){let t=0;const e=this.registers.A.value,r=this.registers.F.halfCarryFlag,h=this.registers.F.carryFlag,x=this.registers.F.subtractionFlag===0;(x&amp;&amp;K.isLeastSignificantNibbleGreaterThan9(e)||r===1)&amp;&amp;(t=d(t,6)),(x&amp;&amp;K.isMostSignificantNibbleGreaterThan9(e)||h===1)&amp;&amp;(t=d(t,96),this.registers.F.carryFlag=1),this.registers.A.value+=x?t:-t,this.setZeroFlag(this.registers.A.value),this.registers.F.halfCarryFlag=0,this.cpu.goToNextInstruction()}static isLeastSignificantNibbleGreaterThan9(t){return m(t,15)&gt;9}static isMostSignificantNibbleGreaterThan9(t){return t&gt;=144}toString(){return"DAA"}}class ue extends c{execute(){this.registers.A.value=~this.registers.A.value,this.registers.F.subtractionFlag=1,this.registers.F.halfCarryFlag=1,this.registers.PC.value++}toString(){return"CPL"}}class he extends c{execute(){this.registers.F.carryFlag=1,this.registers.F.subtractionFlag=0,this.registers.F.halfCarryFlag=0,this.cpu.goToNextInstruction()}toString(){return"SCF"}}class le extends c{execute(){this.registers.F.carryFlag=this.registers.F.carryFlag===0?1:0,this.registers.F.subtractionFlag=0,this.registers.F.halfCarryFlag=0,this.cpu.goToNextInstruction()}toString(){return"CCF"}}class ge extends c{execute(){this.cpu.goToRelativeAddress(this.cpu.getImmediate8())}toString(){return`JR ${this.cpu.imm8}`}}class de extends c{execute(t){if(!this.condition(t).isMet()){this.cpu.goToNextInstruction(Z);return}this.executeJR_IMM8(t)}executeJR_IMM8(t){this.cpu.instructions[24].execute(t)}toString(t){return`JR ${this.condition(t)}, ${this.cpu.imm8}`}}class _e extends c{execute(){throw new Error("STOP instruction not implemented")}toString(){return"STOP"}}class me extends c{execute(t){this.r8Source(t).copyValueInto(this.r8Dest(t)),this.cpu.goToNextInstruction()}toString(t){return`LD ${this.r8Dest(t)}, ${this.r8Source(t)}`}}class xe extends c{execute(){throw new Error("HALT instruction not implemented")}toString(){return"HALT"}}class T{constructor(t,e){i(this,"register");i(this,"registers");this.register=t,this.registers=e}get(){return this.registers.r8[this.register]}getValue(){return this.registers.r8[this.register].value}getAdditionalBytes(){return 0}}class L{constructor(t){i(this,"cpu");this.cpu=t}get(){return this.cpu.imm8}getValue(){return this.cpu.getImmediate8()}getAdditionalBytes(){return 1}}class Ct extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.registers.A.value,r=this.source.getValue(),h=e+r;this.registers.A.value=h,this.updateFlagsAfterAddition(e,r,h),this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`ADD ${this.registers.A}, ${this.source.get()}`}}class D extends Ct{constructor(t,e){super(t,new T(e,t.registers))}}class Se extends Ct{constructor(t){super(t,new L(t))}}class Rt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.registers.A.value,r=this.source.getValue(),h=this.registers.F.carryFlag,g=e+r+h;this.registers.A.value=g,this.updateFlagsAfterAddition(e,r+h,g),this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`ADC ${this.registers.A}, ${this.source.get()}`}}class f extends Rt{constructor(t,e){super(t,new T(e,t.registers))}}class we extends Rt{constructor(t){super(t,new L(t))}}class Tt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.registers.A.value,r=this.source.getValue(),h=e-r;this.registers.A.value=h,this.updateFlagsAfterSubtraction(e,r,h),this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`SUB ${this.registers.A}, ${this.source.get()}`}}class b extends Tt{constructor(t,e){super(t,new T(e,t.registers))}}class Ae extends Tt{constructor(t){super(t,new L(t))}}class Lt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.registers.A.value,r=this.source.getValue(),h=this.registers.F.carryFlag,g=e-r-h;this.registers.A.value=g,this.updateFlagsAfterSubtraction(e,r-h,g),this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`SBC ${this.registers.A}, ${this.source.get()}`}}class $ extends Lt{constructor(t,e){super(t,new T(e,t.registers))}}class Fe extends Lt{constructor(t){super(t,new L(t))}}class Dt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.source.getValue();this.registers.A.value=m(this.registers.A.value,e),this.setZeroFlag(this.registers.A.value),this.registers.F.carryFlag=0,this.registers.F.halfCarryFlag=1,this.registers.F.subtractionFlag=0,this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`AND ${this.registers.A}, ${this.source.get()}`}}class N extends Dt{constructor(t,e){super(t,new T(e,t.registers))}}class Ie extends Dt{constructor(t){super(t,new L(t))}}class ft extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.source.getValue();this.registers.A.value=at(this.registers.A.value,e),this.setZeroFlag(this.registers.A.value),this.registers.F.carryFlag=0,this.registers.F.halfCarryFlag=0,this.registers.F.subtractionFlag=0,this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`XOR ${this.registers.A}, ${this.source.get()}`}}class M extends ft{constructor(t,e){super(t,new T(e,t.registers))}}class ve extends ft{constructor(t){super(t,new L(t))}}class bt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.source.getValue();this.registers.A.value=d(this.registers.A.value,e),this.setZeroFlag(this.registers.A.value),this.registers.F.carryFlag=0,this.registers.F.halfCarryFlag=0,this.registers.F.subtractionFlag=0,this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`OR ${this.registers.A}, ${this.source.get()}`}}class P extends bt{constructor(t,e){super(t,new T(e,t.registers))}}class ye extends bt{constructor(t){super(t,new L(t))}}class $t extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.source.getValue(),r=this.registers.A.value-e;this.updateFlagsAfterSubtraction(this.registers.A.value,e,r),this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`CP ${this.registers.A}, ${this.source.get()}`}}class E extends $t{constructor(t,e){super(t,new T(e,t.registers))}}class Ce extends $t{constructor(t){super(t,new L(t))}}class Re extends c{execute(){this.registers.popPCFromStack(),this.cpu.goToNextInstruction()}toString(){return"RET"}}class Te extends c{execute(t){if(!this.condition(t).isMet()){this.cpu.goToNextInstruction();return}this.executeRET(t)}executeRET(t){this.cpu.instructions[201].execute(t)}toString(t){return`RET ${this.condition(t)}]`}}class Le extends c{execute(){this.cpu.goToAddress(this.cpu.getImmediate16())}toString(){return`JP ${this.cpu.imm16}`}}class De extends c{execute(t){if(!this.condition(t).isMet()){this.cpu.goToNextInstruction(R);return}this.executeJP_IMM16(t)}executeJP_IMM16(t){this.cpu.instructions[195].execute(t)}toString(t){return`JP ${this.condition(t)}, ${this.cpu.imm16}`}}class fe extends c{execute(){this.registers.PC.copyValueFrom(this.registers.HL)}toString(){return`JP ${this.registers.HL}`}}class be extends c{execute(){const t=this.cpu.getImmediate16();this.cpu.goToNextInstruction(R),this.registers.pushPCToStack(),this.cpu.goToAddress(t)}toString(){return`CALL ${this.cpu.imm16}`}}class $e extends c{execute(t){if(!this.condition(t).isMet()){this.cpu.goToNextInstruction(R);return}this.executeCALL_IMM16(t)}executeCALL_IMM16(t){this.cpu.instructions[205].execute(t)}toString(t){return`CALL ${this.condition(t)}, ${this.cpu.imm16}`}}class Ne extends c{execute(t){this.cpu.goToNextInstruction(),this.registers.pushPCToStack(),this.cpu.goToAddress(this.getRSTAddress(t))}getRSTAddress(t){switch(t){case 199:return 24;case 207:return 32;case 215:return 40;case 223:return 48;case 231:return 56;case 239:return 64;case 247:return 72;case 255:return 80;default:throw new Error(`Unknown opcode: ${t}`)}}toString(t){return`RST ${this.getRSTAddress(t).toString(16)}`}}class Me extends c{execute(t){this.r16Stk(t).value=this.registers.popFromStack(),this.cpu.goToNextInstruction()}toString(t){return`POP ${this.r16Stk(t).name}`}}class Pe extends c{execute(t){this.registers.pushToStack(this.r16Stk(t).value),this.cpu.goToNextInstruction()}toString(t){return`PUSH ${this.r16Stk(t).name}`}}class Ee extends c{execute(){this.cpu["[FF00+C]"].copyValueFrom(this.registers.A),this.cpu.goToNextInstruction()}toString(){return`LD ${this.cpu["[FF00+C]"]}, ${this.registers.A}`}}class pe extends c{execute(){this.cpu["[FF00+imm8]"].copyValueFrom(this.registers.A),this.cpu.goToNextInstruction()}toString(){return`LD ${this.cpu["[FF00+imm8]"]}, ${this.registers.A}`}}class He extends c{execute(){this.registers.A.copyValueInto(this.cpu["[imm16]"]),this.cpu.goToNextInstruction(R)}toString(){return`LD ${this.cpu["[imm16]"]}, ${this.registers.A}`}}class Be extends c{execute(){this.registers.A.copyValueFrom(this.cpu["[FF00+C]"]),this.cpu.goToNextInstruction()}toString(){return`LD ${this.registers.A}, ${this.cpu["[FF00+C]"]}`}}class Oe extends c{execute(){this.registers.A.copyValueFrom(this.cpu["[FF00+imm8]"]),this.cpu.goToNextInstruction()}toString(){return`LD ${this.registers.A}, ${this.cpu["[FF00+imm8]"]}`}}class ke extends c{execute(){this.registers.A.copyValueFrom(this.cpu["[imm16]"]),this.cpu.goToNextInstruction(R)}toString(){return`LD ${this.registers.A}, ${this.cpu["[imm16]"]}`}}class Ve extends c{execute(){const t=this.registers.SP.value,e=this.cpu.getImmediate8(),r=t+e;this.registers.SP.value=r,this.updateFlagsAfterAddition(t,e,r,{zeroFlag:0}),this.cpu.goToNextInstruction(Z)}toString(){return`ADD ${this.registers.SP}, ${this.cpu.imm8}`}}class Ue extends c{execute(){const t=this.registers.SP.value,e=this.cpu.getImmediate8(),r=t+e;this.registers.HL.value=r,this.updateFlagsAfterAddition(t,e,r,{zeroFlag:0}),this.cpu.goToNextInstruction(Z)}toString(){return`LD ${this.registers.HL}, ${this.registers.SP} + ${this.cpu.imm8}`}}class Ze extends c{execute(){this.registers.SP.copyValueFrom(this.registers.HL),this.cpu.goToNextInstruction()}toString(){return`LD ${this.registers.SP}, ${this.registers.HL}`}}class Ge extends c{execute(){throw new Error("Not implemented")}toString(){return"RETI"}}class Je extends c{execute(){throw new Error("Not implemented")}toString(){return"EI"}}class ze extends c{execute(){throw new Error("Not implemented")}toString(){return"DI"}}class Ke extends c{execute(){this.cpu.hardLock()}toString(){return"âš  HARD_LOCK"}}class je extends c{execute(t){const e=this.r8Source(t),r=_(e.value,7);e.value=d(V(e.value),r),this.updateFlagsAfterRotate(e.value,r),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) RLC ${this.r8Source(t).name}`}}class We extends c{execute(t){const e=this.r8Source(t),r=_(e.value,0);e.value=d(B(e.value),v(7)(r)),this.updateFlagsAfterRotate(e.value,r),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) RRC ${this.r8Source(t).name}`}}class Xe extends c{execute(t){const e=this.r8Source(t),r=this.registers.F.carryFlag,h=_(e.value,0);e.value=d(B(e.value),v(7)(r)),this.registers.F.carryFlag=h,this.cpu.goToNextInstruction()}toString(t){return`(prefixed) RR ${this.r8Source(t).name}`}}class Ye extends c{execute(t){const e=this.r8Source(t),r=this.registers.F.carryFlag,h=_(e.value,7);e.value=d(V(e.value),r),this.registers.F.carryFlag=h,this.cpu.goToNextInstruction()}toString(t){return`(prefixed) RL ${this.r8Source(t).name}`}}class qe extends c{execute(t){const e=this.r8Source(t),r=_(e.value,7);e.value=V(e.value),this.updateFlagsAfterRotate(e.value,r),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) SLA ${this.r8Source(t).name}`}}class Qe extends c{execute(t){const e=this.r8Source(t),r=_(e.value,0),h=_(e.value,7);e.value=B(e.value),e.value=d(e.value,v(7)(h)),this.updateFlagsAfterRotate(e.value,r),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) SRA ${this.r8Source(t).name}`}}class ts extends c{execute(t){const e=this.r8Source(t),{value:r}=e;e.value=d(v(4)(m(r,15)),ut(m(r,240))),this.updateFlagsAfterRotate(e.value,0),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) SWAP ${this.r8Source(t).name}`}}class es extends c{execute(t){const e=this.r8Source(t),r=_(e.value,0);e.value=B(e.value),this.updateFlagsAfterRotate(e.value,r),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) SRL ${this.r8Source(t).name}`}}class ss extends c{execute(t){const e=this.extractDestinationR8(t);this.registers.F.halfCarryFlag=1,this.registers.F.subtractionFlag=0,this.registers.F.zeroFlag=_(this.r8Source(t).value,e),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) BIT ${this.extractDestinationR8(t)}, ${this.r8Source(t)}`}}class rs extends c{execute(t){const e=this.r8Source(t),r=this.extractDestinationR8(t);e.value=O({number:e.value,bitIndex:r,value:0}),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) RES ${this.extractDestinationR8(t)}, ${this.r8Source(t).name}`}}class is extends c{execute(t){const e=this.r8Source(t),r=this.extractDestinationR8(t);e.value=O({number:e.value,bitIndex:r,value:1}),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) SET ${this.extractDestinationR8(t)}, ${this.r8Source(t).name}`}}class ns extends c{execute(){this.cpu.goToNextInstruction();const t=this.cpu.decodePrefixed(this.memory.addresses[this.registers.PC.value]);this.cpu.executePrefixed(t)}toString(){return"CB (prefixed)"}}class os extends c{execute(){this.cpu.goToNextInstruction()}toString(){return"NOP"}}class ot{static loadPrefixedInstructions(t){const e=new je(t),r=new We(t),h=new Ye(t),g=new Xe(t),x=new qe(t),S=new Qe(t),A=new ts(t),F=new es(t),n=new ss(t),o=new rs(t),a=new is(t);return{0:e,1:e,2:e,3:e,4:e,5:e,6:e,7:e,8:r,9:r,10:r,11:r,12:r,13:r,14:r,15:r,16:h,17:h,18:h,19:h,20:h,21:h,22:h,23:h,24:g,25:g,26:g,27:g,28:g,29:g,30:g,31:g,32:x,33:x,34:x,35:x,36:x,37:x,38:x,39:x,40:S,41:S,42:S,43:S,44:S,45:S,46:S,47:S,48:A,49:A,50:A,51:A,52:A,53:A,54:A,55:A,56:F,57:F,58:F,59:F,60:F,61:F,62:F,63:F,64:n,72:n,80:n,88:n,96:n,104:n,112:n,120:n,65:n,73:n,81:n,89:n,97:n,105:n,113:n,121:n,66:n,74:n,82:n,90:n,98:n,106:n,114:n,122:n,67:n,75:n,83:n,91:n,99:n,107:n,115:n,123:n,68:n,76:n,84:n,92:n,100:n,108:n,116:n,124:n,69:n,77:n,85:n,93:n,101:n,109:n,117:n,125:n,70:n,78:n,86:n,94:n,102:n,110:n,118:n,126:n,71:n,79:n,87:n,95:n,103:n,111:n,119:n,127:n,128:o,136:o,144:o,152:o,160:o,168:o,176:o,184:o,129:o,137:o,145:o,153:o,161:o,169:o,177:o,185:o,130:o,138:o,146:o,154:o,162:o,170:o,178:o,186:o,131:o,139:o,147:o,155:o,163:o,171:o,179:o,187:o,132:o,140:o,148:o,156:o,164:o,172:o,180:o,188:o,133:o,141:o,149:o,157:o,165:o,173:o,181:o,189:o,134:o,142:o,150:o,158:o,166:o,174:o,182:o,190:o,135:o,143:o,151:o,159:o,167:o,175:o,183:o,191:o,192:a,200:a,208:a,216:a,224:a,232:a,240:a,248:a,193:a,201:a,209:a,217:a,225:a,233:a,241:a,249:a,194:a,202:a,210:a,218:a,226:a,234:a,242:a,250:a,195:a,203:a,211:a,219:a,227:a,235:a,243:a,251:a,196:a,204:a,212:a,220:a,228:a,236:a,244:a,252:a,197:a,205:a,213:a,221:a,229:a,237:a,245:a,253:a,198:a,206:a,214:a,222:a,230:a,238:a,246:a,254:a,199:a,207:a,215:a,223:a,231:a,239:a,247:a,255:a}}}i(ot,"loadInstructions",t=&gt;{const e=new os(t),r=new Wt(t),h=new Xt(t),g=new Yt(t),x=new qt(t),S=new Qt(t),A=new te(t),F=new ee(t),n=new se(t),o=new re(t),a=new ie(t),cs=new ne(t),us=new oe(t),hs=new ae(t),ls=new ce(t),gs=new K(t),ds=new ue(t),_s=new he(t),ms=new le(t),xs=new ge(t),j=new de(t),Ss=new _e(t),ws=new xe(t),u=new me(t),As=new D(t,0),Fs=new D(t,1),Is=new D(t,2),vs=new D(t,3),ys=new D(t,4),Cs=new D(t,5),Rs=new D(t,6),Ts=new D(t,7),Ls=new Se(t),Ds=new f(t,0),fs=new f(t,1),bs=new f(t,2),$s=new f(t,3),Ns=new f(t,4),Ms=new f(t,5),Ps=new f(t,6),Es=new f(t,7),ps=new we(t),Hs=new b(t,0),Bs=new b(t,1),Os=new b(t,2),ks=new b(t,3),Vs=new b(t,4),Us=new b(t,5),Zs=new b(t,6),Gs=new b(t,7),Js=new Ae(t),zs=new $(t,0),Ks=new $(t,1),js=new $(t,2),Ws=new $(t,3),Xs=new $(t,4),Ys=new $(t,5),qs=new $(t,6),Qs=new $(t,7),tr=new Fe(t),er=new N(t,0),sr=new N(t,1),rr=new N(t,2),ir=new N(t,3),nr=new N(t,4),or=new N(t,5),ar=new N(t,6),cr=new N(t,7),ur=new Ie(t),hr=new M(t,0),lr=new M(t,1),gr=new M(t,2),dr=new M(t,3),_r=new M(t,4),mr=new M(t,5),xr=new M(t,6),Sr=new M(t,7),wr=new ve(t),Ar=new P(t,0),Fr=new P(t,1),Ir=new P(t,2),vr=new P(t,3),yr=new P(t,4),Cr=new P(t,5),Rr=new P(t,6),Tr=new P(t,7),Lr=new ye(t),Dr=new E(t,0),fr=new E(t,1),br=new E(t,2),$r=new E(t,3),Nr=new E(t,4),Mr=new E(t,5),Pr=new E(t,6),Er=new E(t,7),pr=new Ce(t),W=new Te(t),Hr=new Re(t),Br=new Ge(t),Or=new Le(t),X=new De(t),kr=new fe(t),Vr=new be(t),Y=new $e(t),p=new Ne(t),q=new Me(t),Q=new Pe(t),Ur=new Ee(t),Zr=new pe(t),Gr=new He(t),Jr=new Be(t),zr=new Oe(t),Kr=new ke(t),jr=new Ve(t),Wr=new Ue(t),Xr=new Ze(t),Yr=new Je(t),qr=new ze(t),I=new Ke(t),Qr=new ns(t);return{0:e,1:r,17:r,33:r,49:r,2:h,18:h,34:h,50:h,10:g,26:g,42:g,58:g,8:x,3:S,19:S,35:S,51:S,11:A,27:A,43:A,59:A,9:F,25:F,41:F,57:F,4:n,12:n,20:n,28:n,36:n,44:n,52:n,60:n,5:o,13:o,21:o,29:o,37:o,45:o,53:o,61:o,6:a,14:a,22:a,30:a,38:a,46:a,54:a,62:a,7:cs,15:us,23:hs,31:ls,39:gs,47:ds,55:_s,63:ms,24:xs,32:j,40:j,48:j,56:j,16:Ss,118:ws,64:u,72:u,80:u,88:u,96:u,104:u,112:u,120:u,65:u,73:u,81:u,89:u,97:u,105:u,113:u,121:u,66:u,74:u,82:u,90:u,98:u,106:u,114:u,122:u,67:u,75:u,83:u,91:u,99:u,107:u,115:u,123:u,68:u,76:u,84:u,92:u,100:u,108:u,116:u,124:u,69:u,77:u,85:u,93:u,101:u,109:u,117:u,125:u,70:u,78:u,86:u,94:u,102:u,110:u,126:u,71:u,79:u,87:u,95:u,103:u,111:u,119:u,127:u,128:As,129:Fs,130:Is,131:vs,132:ys,133:Cs,134:Rs,135:Ts,198:Ls,136:Ds,137:fs,138:bs,139:$s,140:Ns,141:Ms,142:Ps,143:Es,206:ps,144:Hs,145:Bs,146:Os,147:ks,148:Vs,149:Us,150:Zs,151:Gs,214:Js,152:zs,153:Ks,154:js,155:Ws,156:Xs,157:Ys,158:qs,159:Qs,222:tr,160:er,161:sr,162:rr,163:ir,164:nr,165:or,166:ar,167:cr,230:ur,168:hr,169:lr,170:gr,171:dr,172:_r,173:mr,174:xr,175:Sr,238:wr,176:Ar,177:Fr,178:Ir,179:vr,180:yr,181:Cr,182:Rr,183:Tr,246:Lr,184:Dr,185:fr,186:br,187:$r,188:Nr,189:Mr,190:Pr,191:Er,254:pr,192:W,200:W,208:W,216:W,201:Hr,217:Br,195:Or,194:X,202:X,210:X,218:X,233:kr,205:Vr,196:Y,204:Y,212:Y,220:Y,199:p,207:p,215:p,223:p,231:p,239:p,247:p,255:p,193:q,209:q,225:q,241:q,197:Q,213:Q,229:Q,245:Q,226:Ur,224:Zr,234:Gr,242:Jr,240:zr,250:Kr,232:jr,248:Wr,249:Xr,251:Yr,243:qr,211:I,219:I,221:I,227:I,228:I,235:I,236:I,237:I,244:I,252:I,253:I,203:Qr}});class as{constructor(t){i(this,"registers");i(this,"memory");i(this,"instructions");i(this,"prefixedInstructions");i(this,"hardLocked",!1);i(this,"imm8");i(this,"imm16");i(this,"[imm8]");i(this,"[imm16]");i(this,"[FF00+C]");i(this,"[FF00+imm8]");this.registers=t.registers,this.memory=t.memory,this.imm8=new lt(this.memory,this.registers.PC),this.imm16=new gt(this.memory,this.registers.PC),this["[imm8]"]=new y(this.imm8,this.memory),this["[imm16]"]=new At(this.imm16,this.memory),this["[FF00+C]"]=new y(this.registers.C,this.memory,65280),this["[FF00+imm8]"]=new y(this.imm8,this.memory,65280),this.instructions=ot.loadInstructions(this),this.prefixedInstructions=ot.loadPrefixedInstructions(this)}getImmediate8(){return this.imm8.value}getImmediate16(){return this.imm16.value}getCurrentAddress(){return this.registers.PC.value}goToAddress(t){this.registers.PC.value=t}goToRelativeAddress(t){this.registers.PC.value+=t}goToNextInstruction(t=0){this.goToRelativeAddress(1+t)}execute(t){this.instructions[t].execute(t)}executePrefixed(t){this.prefixedInstructions[t].execute(t)}hardLock(){this.hardLocked=!0}isHardLocked(){return this.hardLocked}loadROM(t){for(const[e,r]of[...t].entries())this.memory.write(e,r)}startDispatchLoop(){setInterval(()=&gt;{this.dispatch()},1e3/60)}dispatch(){const t=this.decode(this.fetchNextByte()),e=this.instructions[t];return console.log(`Executing opcode : ${t.toString(16).toUpperCase()} | ${t.toString(2)} | ${e.toString(t)}`),e.execute(t),e}fetchNextByte(){const t=this.memory.addresses[this.registers.PC.value];return console.log(`Fetching byte : ${t.toString(16).toUpperCase()} | ${t.toString(2)}`),t}decode(t){const e=t;if(!this.isValidOpcode(e))throw new Error(`Unknown instruction ${e.toString(16).toUpperCase()} | ${e.toString(2)}`);return e}isValidOpcode(t){return this.instructions[t]}decodePrefixed(t){const e=t;if(!Object.keys(this.prefixedInstructions).includes(String(e)))throw new Error("Unknown prefixed instruction");return e}}l.AbstractRegister=nt,l.C=yt,l.COLOR_DEPTH=dt,l.ComposedRegister=G,l.Condition=J,l.Cpu=as,l.Graphics=Zt,l.HLD=St,l.HLI=xt,l.Immediate16=gt,l.Immediate8=lt,l.ImmediateMemoryValue=st,l.Instruction=c,l.Memory=Ut,l.Memory8Value=rt,l.NC=vt,l.NZ=Ft,l.OperationFlags=wt,l.Pointer=y,l.Pointer16=At,l.Register16=k,l.Register8=C,l.Registers=Jt,l.SKIP_IMMEDIATE_16=R,l.SKIP_IMMEDIATE_8=Z,l.TILE_DATA_BYTE_SIZE=it,l.TILE_DATA_WIDTH=z,l.TileData=_t,l.TileDataTable=mt,l.Z=It,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}</span></span>)});</span>
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-03-02T21:41:39.197Z
            </div>
        <script src="../../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../../sorter.js"></script>
        <script src="../../../block-navigation.js"></script>
    </body>
</html>
    