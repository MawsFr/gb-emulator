
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for packages/gb-emulator/dist/gb-emulator.umd.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../../index.html">All files</a> / <a href="index.html">packages/gb-emulator/dist</a> gb-emulator.umd.js</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" ><span class="branch-0 cbranch-no" title="branch not covered" >(function(l,F){typeof exports=="object"&amp;&amp;typeof module&lt;"u"?F(exports):typeof define=="function"&amp;&amp;define.amd?define(["exports"],F):(l=typeof globalThis&lt;"u"?globalThis:l||self,F(l["gb-emulator"]={}))})(this,function(l){"use strict";var ni=Object.defineProperty;var oi=(l,F,d)=&gt;F in l?ni(l,F,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[F]=d;var i=(l,F,d)=&gt;oi(l,typeof F!="symbol"?F+"":F,d);const F=(s,t,{endianness:e}={endianness:"little"})=&gt;e==="big"?d(ut(s),t):d(s,ut(t)),d=(s,t)=&gt;s|t,ht=(s,t)=&gt;s^t,x=(s,t)=&gt;s&amp;t,pt={TWO_LAST_DIGITS:255},B=s=&gt;t=&gt;t&gt;&gt;s,v=s=&gt;t=&gt;t&lt;&lt;s,Ht=B(8),ut=v(8),lt=B(4),O=B(1),U=v(1),gt=s=&gt;Ht(s),dt=s=&gt;x(s,pt.TWO_LAST_DIGITS),_=(s,t,e={endianness:"little"})=&gt;x(B(e.endianness==="big"?7-t:t)(s),1),Bt=s=&gt;_(s,0),Ot=s=&gt;_(s,1),Vt=s=&gt;_(s,2),kt=s=&gt;_(s,3),V=({number:s,bitIndex:t,value:e})=&gt;{const r=v(t)(1);return e===1?d(s,r):x(s,ht(r,255))},Ut=(s,t)=&gt;V({number:s,bitIndex:0,value:t}),Zt=(s,t)=&gt;V({number:s,bitIndex:1,value:t}),Gt=(s,t)=&gt;V({number:s,bitIndex:2,value:t}),Jt=(s,t)=&gt;V({number:s,bitIndex:3,value:t}),_t=(s,t,e={endianness:"little"})=&gt;_(s,t,e)===1,j=s=&gt;`0x${s.toString(16).toUpperCase()}`,mt=s=&gt;typeof s!="number",p=s=&gt;mt(s)?s.value:s;class rt{constructor(t,e,r){i(this,"name");i(this,"memory");i(this,"memoryValue");this.name=t,this.memory=e,this.memoryValue=r}get value(){return this.memoryValue.value}toString(){return`${this.name} (${j(this.value)})`}}const Z=1,C=2;class xt extends rt{constructor(t,e){super("imm8",e,new G(t,e,{offset:1}))}}class wt extends rt{constructor(t,e){super("imm16",e,new nt(t,e,{offset:1}))}}class it{constructor(t,e,r){i(this,"memory");i(this,"offset");i(this,"address");i(this,"name");const{offset:h}=r;this.memory=e,this.address=t,this.offset=h??0,this.name=mt(t)?this.generateName(this.offset,t):void 0}generateName(t,e){return`[${`${t&amp;&amp;t!==0?t:""}+${e.name}`}]`}get value(){return x(this.memory.addresses[p(this.address)+this.offset],255)}set value(t){this.memory.write(p(this.address)+this.offset,t)}toString(){return`${this.name??j(p(this.address)+this.offset)} (${j(this.value)})`}}class G extends it{constructor(t,e,r={offset:0}){super(t,e,r)}}class nt extends it{constructor(e,r,h={endianness:"little",offset:0}){super(e,r,h);i(this,"endianness");this.endianness=h.endianness??"little"}get value(){return F(this.memory.addresses[p(this.address)+this.offset],this.memory.addresses[p(this.address)+this.offset+1],{endianness:this.endianness})}set value(e){const r=gt(e),h=dt(e),g=this.endianness==="big";this.memory.write(p(this.address)+this.offset,g?r:h),this.memory.write(p(this.address)+this.offset+1,g?h:r)}}class J extends G{}class H extends nt{}class zt{constructor(){i(this,"addresses",new Uint8Array(65536));this.addresses.fill(0),this.write(65285,0),this.write(65286,0),this.write(65287,0),this.write(65296,128),this.write(65297,191),this.write(65298,243),this.write(65300,191),this.write(65302,63),this.write(65303,0),this.write(65305,191),this.write(65306,127),this.write(65307,255),this.write(65308,159),this.write(65310,191),this.write(65312,255),this.write(65313,0),this.write(65314,0),this.write(65315,191),this.write(65316,119),this.write(65317,243),this.write(65318,241),this.write(65344,145),this.write(65346,0),this.write(65347,0),this.write(65349,0),this.write(65351,252),this.write(65352,255),this.write(65353,255),this.write(65354,0),this.write(65355,0),this.write(65535,0)}write(t,e){this.addresses[t]=x(e,255)}}const ot=16,W=8,St=2;class At extends G{constructor(e,r,h){super(e,r);i(this,"lines",[]);i(this,"height");this.height=(h==null?void 0:h.height)??ot,this.lines=this.readBytes()}readBytes(){const e=[];for(let r=this.address;r&lt;this.address+this.height;r+=St){const h=this.memory.addresses[r],g=this.memory.addresses[r+1],m=[];for(let w=0;w&lt;W;w++){const S=_(h,w,{endianness:"big"}),A=_(g,w,{endianness:"big"}),n=d(v(1)(A),S);m.push(n)}e.push(m)}return e}}class Ft{constructor(t,e){i(this,"graphics");i(this,"memory");i(this,"tiles");this.graphics=t,this.memory=e,this.tiles=this.readTiles()}readTiles(){const t=[];for(let e=32768;e&lt;=38911;e+=ot)t.push(new At(e,this.memory));return t}render(t){for(const[e,r]of this.tiles.entries()){const h={x:e%16*W,y:Math.floor(e/16)*W};t.drawTile(r,h,this.graphics.palettes.BGP)}}}class Kt{constructor(t){i(this,"memory");i(this,"tileDataTable");i(this,"palettes",{BGP:{0:[255,255,255,1],1:[192,192,192,1],2:[96,96,96,1],3:[0,0,0,1]}});this.memory=t,this.tileDataTable=new Ft(this,this.memory)}render(){throw new Error("Method not implemented.")}}class jt extends G{constructor(t){super(65344,t)}get addressingMode(){return _(this.value,4)}}class Wt{constructor(t,e){i(this,"currentValue");i(this,"SP");this.currentValue=new H(t,e,{endianness:"little"}),this.SP=t}push(t){this.SP.value-=2,this.currentValue.value=t}pop(){const{value:t}=this.currentValue;return this.SP.value+=2,t}}class at{constructor(t,e,r){i(this,"name");i(this,"_value",0);i(this,"_mask");this.name=t,this._mask=e,this._value=r??this._value}get value(){return x(this._value,this._mask)}set value(t){this._value=x(t,this._mask)}copyValueInto(t){t.value=this.value}copyValueFrom(t){this.value=t.value}toString(){return`${this.name} (${j(this.value)})`}}class y extends at{constructor(t){super(t,255)}}class k extends at{constructor(t,e){super(t,65535,e)}incrementOrDecrementIfNeeded(){}}class It extends k{constructor(e){super("HLI");i(this,"HL");this.HL=e}get value(){return this.HL.value}set value(e){this.HL.value=e}incrementOrDecrementIfNeeded(){this.HL.value++}}class vt extends k{constructor(e){super("HLD");i(this,"HL");this.HL=e}get value(){return this.HL.value}set value(e){this.HL.value=e}incrementOrDecrementIfNeeded(){this.HL.value--}}class yt extends y{get zeroFlag(){return Bt(this.value)}get halfCarryFlag(){return Vt(this.value)}get subtractionFlag(){return Ot(this.value)}get carryFlag(){return kt(this.value)}set zeroFlag(t){this.value=Ut(this.value,t)}set halfCarryFlag(t){this.value=Gt(this.value,t)}set subtractionFlag(t){this.value=Zt(this.value,t)}set carryFlag(t){this.value=Jt(this.value,t)}}class z extends k{constructor(e,r,h,g){super(e);i(this,"high");i(this,"low");this.high=r,this.low=h,this.value=g??this.value}get value(){return x(F(this.high.value,this.low.value,{endianness:"big"}),this._mask)}set value(e){this.high.value=gt(e),this.low.value=dt(e)}}class K{constructor(t,e){i(this,"name");i(this,"flags");this.name=t,this.flags=e}toString(){return`COND ${this.name} (${this.isMet()})`}}class Ct extends K{isMet(){return!this.flags.zeroFlag}}class Rt extends K{isMet(){return!!this.flags.zeroFlag}}class Tt extends K{isMet(){return!this.flags.carryFlag}}class ft extends K{isMet(){return!!this.flags.carryFlag}}class Xt{constructor(t){i(this,"memory");i(this,"A",new y("A"));i(this,"B",new y("B"));i(this,"C",new y("C"));i(this,"D",new y("D"));i(this,"E",new y("E"));i(this,"H",new y("H"));i(this,"L",new y("L"));i(this,"F",new yt("F"));i(this,"HL",new z("HL",this.H,this.L,333));i(this,"AF",new z("AF",this.A,this.F,432));i(this,"BC",new z("BC",this.B,this.C,19));i(this,"DE",new z("DE",this.D,this.E,216));i(this,"SP",new k("SP",65534));i(this,"PC",new k("PC",256));i(this,"HLI",new It(this.HL));i(this,"HLD",new vt(this.HL));i(this,"[HL]");i(this,"LCDC");i(this,"stack");i(this,"r8");i(this,"r16",{0:this.BC,1:this.DE,2:this.HL,3:this.SP});i(this,"r16mem",{0:this.BC,1:this.DE,2:this.HLI,3:this.HLD});i(this,"[r16mem]");i(this,"r16Stk",{0:this.BC,1:this.DE,2:this.HL,3:this.AF});i(this,"conditions",{0:new Ct("NZ",this.F),1:new Rt("Z",this.F),2:new Tt("NC",this.F),3:new ft("C",this.F)});this.memory=t,this.LCDC=new jt(t),this.stack=new Wt(this.SP,this.memory),this["[HL]"]=new J(this.HL,t),this.r8={0:this.B,1:this.C,2:this.D,3:this.E,4:this.H,5:this.L,6:this["[HL]"],7:this.A},this["[r16mem]"]={0:new H(this.BC,t),1:new H(this.DE,t),2:new H(this.HLI,t),3:new H(this.HLD,t)}}pushPCToStack(){this.stack.push(this.PC.value)}popPCFromStack(){this.PC.value=this.stack.pop()}}const Yt=48,qt=7,Qt=56;class c{constructor(t){i(this,"cpu");i(this,"registers");i(this,"memory");this.cpu=t,this.registers=t.registers,this.memory=t.memory}updateFlagsAfterAddition(t,e,r,h){const g=(h==null?void 0:h.carryFlagBitIndex)??7,m=(h==null?void 0:h.halfCarryFlagBitIndex)??3;this.registers.F.carryFlag=this.getCarryFlag(t,e,g),this.registers.F.halfCarryFlag=this.getCarryFlag(t,e,m),this.registers.F.subtractionFlag=0,h!=null&amp;&amp;h.zeroFlag?this.registers.F.zeroFlag=h.zeroFlag:this.setZeroFlag(r)}getCarryFlag(t,e,r){return _t(t,r)&amp;&amp;_t(e,r)?1:0}updateFlagsAfterSubtraction(t,e,r){this.registers.F.carryFlag=t&lt;e?1:0,this.registers.F.halfCarryFlag=x(t,15)&lt;x(e,15)?1:0,this.registers.F.subtractionFlag=1,this.setZeroFlag(r)}setZeroFlag(t){this.registers.F.zeroFlag=t===0?1:0}updateFlagsAfterRotate(t,e){this.registers.F.subtractionFlag=0,this.registers.F.halfCarryFlag=0,this.registers.F.carryFlag=e,this.setZeroFlag(t)}r8Dest(t){return this.registers.r8[this.extractDestinationR8(t)]}r8Source(t){return this.registers.r8[this.extractSourceR8(t)]}r16(t){return this.registers.r16[this.extractR16(t)]}r16mem(t){return this.registers.r16mem[this.extractR16(t)]}r16Stk(t){return this.registers.r16Stk[this.extractR16(t)]}"[r16mem]"(t){return this.registers["[r16mem]"][this.extractR16(t)]}extractR16(t){return lt(x(t,Yt))}extractDestinationR8(t){return B(3)(x(t,Qt))}extractSourceR8(t){return x(t,qt)}getCondition(t){return B(3)(x(t,24))}condition(t){return this.registers.conditions[this.getCondition(t)]}}class te extends c{execute(t){this.r16(t).value=this.cpu.getImmediate16(),this.cpu.goToNextInstruction(C)}toString(t){return`LD ${this.r16(t)}, ${this.cpu.imm16}`}}class ee extends c{execute(t){this.registers.A.copyValueInto(this["[r16mem]"](t)),this.r16mem(t).incrementOrDecrementIfNeeded(),this.cpu.goToNextInstruction()}toString(t){return`LD ${this["[r16mem]"](t)}, ${this.registers.A}`}}class se extends c{execute(t){const e=this["[r16mem]"](t);this.registers.A.copyValueFrom(e),this.r16mem(t).incrementOrDecrementIfNeeded(),this.cpu.goToNextInstruction()}toString(t){return`LD ${this.registers.A}, ${this["[r16mem]"](this.extractR16(t))}`}}class re extends c{execute(){this.registers.SP.copyValueInto(this.cpu["[imm16]"]),this.cpu.goToNextInstruction(C)}toString(){return`LD ${this.cpu["[imm16]"]}, ${this.registers.SP}`}}class ie extends c{execute(t){this.r16(t).value++,this.cpu.goToNextInstruction()}toString(t){return`INC ${this.r16(t)}`}}class ne extends c{execute(t){this.r16(t).value--,this.cpu.goToNextInstruction()}toString(t){return`DEC ${this.r16(t)}`}}class oe extends c{execute(t){const e=this.registers.HL.value,r=this.r16(t).value,h=e+r;this.registers.HL.value=h,this.updateFlagsAfterAddition(e,r,h,{halfCarryFlagBitIndex:11,carryFlagBitIndex:15}),this.cpu.goToNextInstruction()}toString(t){return`ADD ${this.registers.HL}, ${this.r16(t)}`}}class ae extends c{execute(t){this.r8Dest(t).value++,this.cpu.goToNextInstruction()}toString(t){return`INC ${this.r8Dest(t)}`}}class ce extends c{execute(t){this.r8Dest(t).value--,this.cpu.goToNextInstruction()}toString(t){return`DEC ${this.r8Dest(t)}`}}class he extends c{execute(t){this.r8Dest(t).value=this.cpu.getImmediate8(),this.cpu.goToNextInstruction(Z)}toString(t){return`LD ${this.r8Dest(t)}, ${this.cpu.imm8}`}}class ue extends c{execute(){const t=_(this.registers.A.value,7);this.registers.A.value=d(U(this.registers.A.value),t),this.registers.F.carryFlag=t,this.cpu.goToNextInstruction()}toString(){return"RLCA"}}class le extends c{execute(){const t=_(this.registers.A.value,0);this.registers.A.value=d(O(this.registers.A.value),v(7)(t)),this.registers.F.carryFlag=t,this.cpu.goToNextInstruction()}toString(){return"RRCA"}}class ge extends c{execute(){const t=this.registers.F.carryFlag,e=_(this.registers.A.value,7);this.registers.A.value=d(U(this.registers.A.value),t),this.registers.F.carryFlag=e,this.cpu.goToNextInstruction()}toString(){return"RLA"}}class de extends c{execute(){const t=this.registers.F.carryFlag,e=_(this.registers.A.value,0);this.registers.A.value=d(O(this.registers.A.value),v(7)(t)),this.registers.F.carryFlag=e,this.cpu.goToNextInstruction()}toString(){return"RRA"}}class X extends c{execute(){let t=0;const e=this.registers.A.value,r=this.registers.F.halfCarryFlag,h=this.registers.F.carryFlag,m=this.registers.F.subtractionFlag===0;(m&amp;&amp;X.isLeastSignificantNibbleGreaterThan9(e)||r===1)&amp;&amp;(t=d(t,6)),(m&amp;&amp;X.isMostSignificantNibbleGreaterThan9(e)||h===1)&amp;&amp;(t=d(t,96),this.registers.F.carryFlag=1),this.registers.A.value+=m?t:-t,this.setZeroFlag(this.registers.A.value),this.registers.F.halfCarryFlag=0,this.cpu.goToNextInstruction()}static isLeastSignificantNibbleGreaterThan9(t){return x(t,15)&gt;9}static isMostSignificantNibbleGreaterThan9(t){return t&gt;=144}toString(){return"DAA"}}class _e extends c{execute(){this.registers.A.value=~this.registers.A.value,this.registers.F.subtractionFlag=1,this.registers.F.halfCarryFlag=1,this.registers.PC.value++}toString(){return"CPL"}}class me extends c{execute(){this.registers.F.carryFlag=1,this.registers.F.subtractionFlag=0,this.registers.F.halfCarryFlag=0,this.cpu.goToNextInstruction()}toString(){return"SCF"}}class xe extends c{execute(){this.registers.F.carryFlag=this.registers.F.carryFlag===0?1:0,this.registers.F.subtractionFlag=0,this.registers.F.halfCarryFlag=0,this.cpu.goToNextInstruction()}toString(){return"CCF"}}class we extends c{execute(){this.cpu.goToRelativeAddress(this.cpu.getImmediate8())}toString(){return`JR ${this.cpu.imm8}`}}class Se extends c{execute(t){if(!this.condition(t).isMet()){this.cpu.goToNextInstruction(Z);return}this.executeJR_IMM8(t)}executeJR_IMM8(t){this.cpu.instructions[24].execute(t)}toString(t){return`JR ${this.condition(t)}, ${this.cpu.imm8}`}}class Ae extends c{execute(){throw new Error("STOP instruction not implemented")}toString(){return"STOP"}}class Fe extends c{execute(t){this.r8Source(t).copyValueInto(this.r8Dest(t)),this.cpu.goToNextInstruction()}toString(t){return`LD ${this.r8Dest(t)}, ${this.r8Source(t)}`}}class Ie extends c{execute(){throw new Error("HALT instruction not implemented")}toString(){return"HALT"}}class R{constructor(t,e){i(this,"register");i(this,"registers");this.register=t,this.registers=e}get(){return this.registers.r8[this.register]}getValue(){return this.registers.r8[this.register].value}getAdditionalBytes(){return 0}}class T{constructor(t){i(this,"cpu");this.cpu=t}get(){return this.cpu.imm8}getValue(){return this.cpu.getImmediate8()}getAdditionalBytes(){return 1}}class Lt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.registers.A.value,r=this.source.getValue(),h=e+r;this.registers.A.value=h,this.updateFlagsAfterAddition(e,r,h),this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`ADD ${this.registers.A}, ${this.source.get()}`}}class f extends Lt{constructor(t,e){super(t,new R(e,t.registers))}}class ve extends Lt{constructor(t){super(t,new T(t))}}class Dt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.registers.A.value,r=this.source.getValue(),h=this.registers.F.carryFlag,g=e+r+h;this.registers.A.value=g,this.updateFlagsAfterAddition(e,r+h,g),this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`ADC ${this.registers.A}, ${this.source.get()}`}}class L extends Dt{constructor(t,e){super(t,new R(e,t.registers))}}class ye extends Dt{constructor(t){super(t,new T(t))}}class bt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.registers.A.value,r=this.source.getValue(),h=e-r;this.registers.A.value=h,this.updateFlagsAfterSubtraction(e,r,h),this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`SUB ${this.registers.A}, ${this.source.get()}`}}class D extends bt{constructor(t,e){super(t,new R(e,t.registers))}}class Ce extends bt{constructor(t){super(t,new T(t))}}class $t extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.registers.A.value,r=this.source.getValue(),h=this.registers.F.carryFlag,g=e-r-h;this.registers.A.value=g,this.updateFlagsAfterSubtraction(e,r-h,g),this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`SBC ${this.registers.A}, ${this.source.get()}`}}class b extends $t{constructor(t,e){super(t,new R(e,t.registers))}}class Re extends $t{constructor(t){super(t,new T(t))}}class Mt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.source.getValue();this.registers.A.value=x(this.registers.A.value,e),this.setZeroFlag(this.registers.A.value),this.registers.F.carryFlag=0,this.registers.F.halfCarryFlag=1,this.registers.F.subtractionFlag=0,this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`AND ${this.registers.A}, ${this.source.get()}`}}class $ extends Mt{constructor(t,e){super(t,new R(e,t.registers))}}class Te extends Mt{constructor(t){super(t,new T(t))}}class Nt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.source.getValue();this.registers.A.value=ht(this.registers.A.value,e),this.setZeroFlag(this.registers.A.value),this.registers.F.carryFlag=0,this.registers.F.halfCarryFlag=0,this.registers.F.subtractionFlag=0,this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`XOR ${this.registers.A}, ${this.source.get()}`}}class M extends Nt{constructor(t,e){super(t,new R(e,t.registers))}}class fe extends Nt{constructor(t){super(t,new T(t))}}class Pt extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.source.getValue();this.registers.A.value=d(this.registers.A.value,e),this.setZeroFlag(this.registers.A.value),this.registers.F.carryFlag=0,this.registers.F.halfCarryFlag=0,this.registers.F.subtractionFlag=0,this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`OR ${this.registers.A}, ${this.source.get()}`}}class N extends Pt{constructor(t,e){super(t,new R(e,t.registers))}}class Le extends Pt{constructor(t){super(t,new T(t))}}class Et extends c{constructor(e,r){super(e);i(this,"source");this.source=r}execute(){const e=this.source.getValue(),r=this.registers.A.value-e;this.updateFlagsAfterSubtraction(this.registers.A.value,e,r),this.cpu.goToNextInstruction(this.source.getAdditionalBytes())}toString(){return`CP ${this.registers.A}, ${this.source.get()}`}}class P extends Et{constructor(t,e){super(t,new R(e,t.registers))}}class De extends Et{constructor(t){super(t,new T(t))}}class be extends c{execute(){this.registers.popPCFromStack(),this.cpu.goToNextInstruction()}toString(){return"RET"}}class $e extends c{execute(t){if(!this.condition(t).isMet()){this.cpu.goToNextInstruction();return}this.executeRET(t)}executeRET(t){this.cpu.instructions[201].execute(t)}toString(t){return`RET ${this.condition(t)}]`}}class Me extends c{execute(){this.cpu.goToAddress(this.cpu.getImmediate16())}toString(){return`JP ${this.cpu.imm16}`}}class Ne extends c{execute(t){if(!this.condition(t).isMet()){this.cpu.goToNextInstruction(C);return}this.executeJP_IMM16(t)}executeJP_IMM16(t){this.cpu.instructions[195].execute(t)}toString(t){return`JP ${this.condition(t)}, ${this.cpu.imm16}`}}class Pe extends c{execute(){this.registers.PC.copyValueFrom(this.registers.HL)}toString(){return`JP ${this.registers.HL}`}}class Ee extends c{execute(){const t=this.cpu.getImmediate16();this.cpu.goToNextInstruction(C),this.registers.pushPCToStack(),this.cpu.goToAddress(t)}toString(){return`CALL ${this.cpu.imm16}`}}class pe extends c{execute(t){if(!this.condition(t).isMet()){this.cpu.goToNextInstruction(C);return}this.executeCALL_IMM16(t)}executeCALL_IMM16(t){this.cpu.instructions[205].execute(t)}toString(t){return`CALL ${this.condition(t)}, ${this.cpu.imm16}`}}class He extends c{execute(t){this.cpu.goToNextInstruction(),this.registers.pushPCToStack(),this.cpu.goToAddress(this.getRSTAddress(t))}getRSTAddress(t){switch(t){case 199:return 24;case 207:return 32;case 215:return 40;case 223:return 48;case 231:return 56;case 239:return 64;case 247:return 72;case 255:return 80;default:throw new Error(`Unknown opcode: ${t}`)}}toString(t){return`RST ${this.getRSTAddress(t).toString(16)}`}}class Be extends c{execute(t){this.r16Stk(t).value=this.registers.stack.pop(),this.cpu.goToNextInstruction()}toString(t){return`POP ${this.r16Stk(t).name}`}}class Oe extends c{execute(t){this.registers.stack.push(this.r16Stk(t).value),this.cpu.goToNextInstruction()}toString(t){return`PUSH ${this.r16Stk(t).name}`}}class Ve extends c{execute(){this.registers.A.copyValueInto(this.cpu["[FF00+C]"]),this.cpu.goToNextInstruction()}toString(){return`LD ${this.cpu["[FF00+C]"]}, ${this.registers.A}`}}class ke extends c{execute(){this.registers.A.copyValueInto(this.cpu["[FF00+imm8]"]),this.cpu.goToNextInstruction()}toString(){return`LD ${this.cpu["[FF00+imm8]"]}, ${this.registers.A}`}}class Ue extends c{execute(){this.registers.A.copyValueInto(this.cpu["[imm16]"]),this.cpu.goToNextInstruction(C)}toString(){return`LD ${this.cpu["[imm16]"]}, ${this.registers.A}`}}class Ze extends c{execute(){this.registers.A.copyValueFrom(this.cpu["[FF00+C]"]),this.cpu.goToNextInstruction()}toString(){return`LD ${this.registers.A}, ${this.cpu["[FF00+C]"]}`}}class Ge extends c{execute(){this.registers.A.copyValueFrom(this.cpu["[FF00+imm8]"]),this.cpu.goToNextInstruction()}toString(){return`LD ${this.registers.A}, ${this.cpu["[FF00+imm8]"]}`}}class Je extends c{execute(){this.registers.A.copyValueFrom(this.cpu["[imm16]"]),this.cpu.goToNextInstruction(C)}toString(){return`LD ${this.registers.A}, ${this.cpu["[imm16]"]}`}}class ze extends c{execute(){const t=this.registers.SP.value,e=this.cpu.getImmediate8(),r=t+e;this.registers.SP.value=r,this.updateFlagsAfterAddition(t,e,r,{zeroFlag:0}),this.cpu.goToNextInstruction(Z)}toString(){return`ADD ${this.registers.SP}, ${this.cpu.imm8}`}}class Ke extends c{execute(){const t=this.registers.SP.value,e=this.cpu.getImmediate8(),r=t+e;this.registers.HL.value=r,this.updateFlagsAfterAddition(t,e,r,{zeroFlag:0}),this.cpu.goToNextInstruction(Z)}toString(){return`LD ${this.registers.HL}, ${this.registers.SP} + ${this.cpu.imm8}`}}class je extends c{execute(){this.registers.SP.copyValueFrom(this.registers.HL),this.cpu.goToNextInstruction()}toString(){return`LD ${this.registers.SP}, ${this.registers.HL}`}}class We extends c{execute(){throw new Error("Not implemented")}toString(){return"RETI"}}class Xe extends c{execute(){throw new Error("Not implemented")}toString(){return"EI"}}class Ye extends c{execute(){throw new Error("Not implemented")}toString(){return"DI"}}class qe extends c{execute(){this.cpu.hardLock()}toString(){return"⚠ HARD_LOCK"}}class Qe extends c{execute(t){const e=this.r8Source(t),r=_(e.value,7);e.value=d(U(e.value),r),this.updateFlagsAfterRotate(e.value,r),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) RLC ${this.r8Source(t).name}`}}class ts extends c{execute(t){const e=this.r8Source(t),r=_(e.value,0);e.value=d(O(e.value),v(7)(r)),this.updateFlagsAfterRotate(e.value,r),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) RRC ${this.r8Source(t).name}`}}class es extends c{execute(t){const e=this.r8Source(t),r=this.registers.F.carryFlag,h=_(e.value,0);e.value=d(O(e.value),v(7)(r)),this.registers.F.carryFlag=h,this.cpu.goToNextInstruction()}toString(t){return`(prefixed) RR ${this.r8Source(t).name}`}}class ss extends c{execute(t){const e=this.r8Source(t),r=this.registers.F.carryFlag,h=_(e.value,7);e.value=d(U(e.value),r),this.registers.F.carryFlag=h,this.cpu.goToNextInstruction()}toString(t){return`(prefixed) RL ${this.r8Source(t).name}`}}class rs extends c{execute(t){const e=this.r8Source(t),r=_(e.value,7);e.value=U(e.value),this.updateFlagsAfterRotate(e.value,r),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) SLA ${this.r8Source(t).name}`}}class is extends c{execute(t){const e=this.r8Source(t),r=_(e.value,0),h=_(e.value,7);e.value=O(e.value),e.value=d(e.value,v(7)(h)),this.updateFlagsAfterRotate(e.value,r),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) SRA ${this.r8Source(t).name}`}}class ns extends c{execute(t){const e=this.r8Source(t),{value:r}=e;e.value=d(v(4)(x(r,15)),lt(x(r,240))),this.updateFlagsAfterRotate(e.value,0),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) SWAP ${this.r8Source(t).name}`}}class os extends c{execute(t){const e=this.r8Source(t),r=_(e.value,0);e.value=O(e.value),this.updateFlagsAfterRotate(e.value,r),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) SRL ${this.r8Source(t).name}`}}class as extends c{execute(t){const e=this.extractDestinationR8(t);this.registers.F.halfCarryFlag=1,this.registers.F.subtractionFlag=0,this.registers.F.zeroFlag=_(this.r8Source(t).value,e),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) BIT ${this.extractDestinationR8(t)}, ${this.r8Source(t)}`}}class cs extends c{execute(t){const e=this.r8Source(t),r=this.extractDestinationR8(t);e.value=V({number:e.value,bitIndex:r,value:0}),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) RES ${this.extractDestinationR8(t)}, ${this.r8Source(t).name}`}}class hs extends c{execute(t){const e=this.r8Source(t),r=this.extractDestinationR8(t);e.value=V({number:e.value,bitIndex:r,value:1}),this.cpu.goToNextInstruction()}toString(t){return`(prefixed) SET ${this.extractDestinationR8(t)}, ${this.r8Source(t).name}`}}class us extends c{execute(){this.cpu.goToNextInstruction();const t=this.cpu.decodePrefixed(this.memory.addresses[this.registers.PC.value]);this.cpu.executePrefixed(t)}toString(){return"CB (prefixed)"}}class ls extends c{execute(){this.cpu.goToNextInstruction()}toString(){return"NOP"}}class ct{static loadPrefixedInstructions(t){const e=new Qe(t),r=new ts(t),h=new ss(t),g=new es(t),m=new rs(t),w=new is(t),S=new ns(t),A=new os(t),n=new as(t),o=new cs(t),a=new hs(t);return{0:e,1:e,2:e,3:e,4:e,5:e,6:e,7:e,8:r,9:r,10:r,11:r,12:r,13:r,14:r,15:r,16:h,17:h,18:h,19:h,20:h,21:h,22:h,23:h,24:g,25:g,26:g,27:g,28:g,29:g,30:g,31:g,32:m,33:m,34:m,35:m,36:m,37:m,38:m,39:m,40:w,41:w,42:w,43:w,44:w,45:w,46:w,47:w,48:S,49:S,50:S,51:S,52:S,53:S,54:S,55:S,56:A,57:A,58:A,59:A,60:A,61:A,62:A,63:A,64:n,72:n,80:n,88:n,96:n,104:n,112:n,120:n,65:n,73:n,81:n,89:n,97:n,105:n,113:n,121:n,66:n,74:n,82:n,90:n,98:n,106:n,114:n,122:n,67:n,75:n,83:n,91:n,99:n,107:n,115:n,123:n,68:n,76:n,84:n,92:n,100:n,108:n,116:n,124:n,69:n,77:n,85:n,93:n,101:n,109:n,117:n,125:n,70:n,78:n,86:n,94:n,102:n,110:n,118:n,126:n,71:n,79:n,87:n,95:n,103:n,111:n,119:n,127:n,128:o,136:o,144:o,152:o,160:o,168:o,176:o,184:o,129:o,137:o,145:o,153:o,161:o,169:o,177:o,185:o,130:o,138:o,146:o,154:o,162:o,170:o,178:o,186:o,131:o,139:o,147:o,155:o,163:o,171:o,179:o,187:o,132:o,140:o,148:o,156:o,164:o,172:o,180:o,188:o,133:o,141:o,149:o,157:o,165:o,173:o,181:o,189:o,134:o,142:o,150:o,158:o,166:o,174:o,182:o,190:o,135:o,143:o,151:o,159:o,167:o,175:o,183:o,191:o,192:a,200:a,208:a,216:a,224:a,232:a,240:a,248:a,193:a,201:a,209:a,217:a,225:a,233:a,241:a,249:a,194:a,202:a,210:a,218:a,226:a,234:a,242:a,250:a,195:a,203:a,211:a,219:a,227:a,235:a,243:a,251:a,196:a,204:a,212:a,220:a,228:a,236:a,244:a,252:a,197:a,205:a,213:a,221:a,229:a,237:a,245:a,253:a,198:a,206:a,214:a,222:a,230:a,238:a,246:a,254:a,199:a,207:a,215:a,223:a,231:a,239:a,247:a,255:a}}}i(ct,"loadInstructions",t=&gt;{const e=new ls(t),r=new te(t),h=new ee(t),g=new se(t),m=new re(t),w=new ie(t),S=new ne(t),A=new oe(t),n=new ae(t),o=new ce(t),a=new he(t),ds=new ue(t),_s=new le(t),ms=new ge(t),xs=new de(t),ws=new X(t),Ss=new _e(t),As=new me(t),Fs=new xe(t),Is=new we(t),Y=new Se(t),vs=new Ae(t),ys=new Ie(t),u=new Fe(t),Cs=new f(t,0),Rs=new f(t,1),Ts=new f(t,2),fs=new f(t,3),Ls=new f(t,4),Ds=new f(t,5),bs=new f(t,6),$s=new f(t,7),Ms=new ve(t),Ns=new L(t,0),Ps=new L(t,1),Es=new L(t,2),ps=new L(t,3),Hs=new L(t,4),Bs=new L(t,5),Os=new L(t,6),Vs=new L(t,7),ks=new ye(t),Us=new D(t,0),Zs=new D(t,1),Gs=new D(t,2),Js=new D(t,3),zs=new D(t,4),Ks=new D(t,5),js=new D(t,6),Ws=new D(t,7),Xs=new Ce(t),Ys=new b(t,0),qs=new b(t,1),Qs=new b(t,2),tr=new b(t,3),er=new b(t,4),sr=new b(t,5),rr=new b(t,6),ir=new b(t,7),nr=new Re(t),or=new $(t,0),ar=new $(t,1),cr=new $(t,2),hr=new $(t,3),ur=new $(t,4),lr=new $(t,5),gr=new $(t,6),dr=new $(t,7),_r=new Te(t),mr=new M(t,0),xr=new M(t,1),wr=new M(t,2),Sr=new M(t,3),Ar=new M(t,4),Fr=new M(t,5),Ir=new M(t,6),vr=new M(t,7),yr=new fe(t),Cr=new N(t,0),Rr=new N(t,1),Tr=new N(t,2),fr=new N(t,3),Lr=new N(t,4),Dr=new N(t,5),br=new N(t,6),$r=new N(t,7),Mr=new Le(t),Nr=new P(t,0),Pr=new P(t,1),Er=new P(t,2),pr=new P(t,3),Hr=new P(t,4),Br=new P(t,5),Or=new P(t,6),Vr=new P(t,7),kr=new De(t),q=new $e(t),Ur=new be(t),Zr=new We(t),Gr=new Me(t),Q=new Ne(t),Jr=new Pe(t),zr=new Ee(t),tt=new pe(t),E=new He(t),et=new Be(t),st=new Oe(t),Kr=new Ve(t),jr=new ke(t),Wr=new Ue(t),Xr=new Ze(t),Yr=new Ge(t),qr=new Je(t),Qr=new ze(t),ti=new Ke(t),ei=new je(t),si=new Xe(t),ri=new Ye(t),I=new qe(t),ii=new us(t);return{0:e,1:r,17:r,33:r,49:r,2:h,18:h,34:h,50:h,10:g,26:g,42:g,58:g,8:m,3:w,19:w,35:w,51:w,11:S,27:S,43:S,59:S,9:A,25:A,41:A,57:A,4:n,12:n,20:n,28:n,36:n,44:n,52:n,60:n,5:o,13:o,21:o,29:o,37:o,45:o,53:o,61:o,6:a,14:a,22:a,30:a,38:a,46:a,54:a,62:a,7:ds,15:_s,23:ms,31:xs,39:ws,47:Ss,55:As,63:Fs,24:Is,32:Y,40:Y,48:Y,56:Y,16:vs,118:ys,64:u,72:u,80:u,88:u,96:u,104:u,112:u,120:u,65:u,73:u,81:u,89:u,97:u,105:u,113:u,121:u,66:u,74:u,82:u,90:u,98:u,106:u,114:u,122:u,67:u,75:u,83:u,91:u,99:u,107:u,115:u,123:u,68:u,76:u,84:u,92:u,100:u,108:u,116:u,124:u,69:u,77:u,85:u,93:u,101:u,109:u,117:u,125:u,70:u,78:u,86:u,94:u,102:u,110:u,126:u,71:u,79:u,87:u,95:u,103:u,111:u,119:u,127:u,128:Cs,129:Rs,130:Ts,131:fs,132:Ls,133:Ds,134:bs,135:$s,198:Ms,136:Ns,137:Ps,138:Es,139:ps,140:Hs,141:Bs,142:Os,143:Vs,206:ks,144:Us,145:Zs,146:Gs,147:Js,148:zs,149:Ks,150:js,151:Ws,214:Xs,152:Ys,153:qs,154:Qs,155:tr,156:er,157:sr,158:rr,159:ir,222:nr,160:or,161:ar,162:cr,163:hr,164:ur,165:lr,166:gr,167:dr,230:_r,168:mr,169:xr,170:wr,171:Sr,172:Ar,173:Fr,174:Ir,175:vr,238:yr,176:Cr,177:Rr,178:Tr,179:fr,180:Lr,181:Dr,182:br,183:$r,246:Mr,184:Nr,185:Pr,186:Er,187:pr,188:Hr,189:Br,190:Or,191:Vr,254:kr,192:q,200:q,208:q,216:q,201:Ur,217:Zr,195:Gr,194:Q,202:Q,210:Q,218:Q,233:Jr,205:zr,196:tt,204:tt,212:tt,220:tt,199:E,207:E,215:E,223:E,231:E,239:E,247:E,255:E,193:et,209:et,225:et,241:et,197:st,213:st,229:st,245:st,226:Kr,224:jr,234:Wr,242:Xr,240:Yr,250:qr,232:Qr,248:ti,249:ei,251:si,243:ri,211:I,219:I,221:I,227:I,228:I,235:I,236:I,237:I,244:I,252:I,253:I,203:ii}});class gs{constructor(t){i(this,"registers");i(this,"memory");i(this,"instructions");i(this,"prefixedInstructions");i(this,"hardLocked",!1);i(this,"imm8");i(this,"imm16");i(this,"[imm8]");i(this,"[imm16]");i(this,"[FF00+C]");i(this,"[FF00+imm8]");this.registers=t.registers,this.memory=t.memory,this.imm8=new xt(this.registers.PC,this.memory),this.imm16=new wt(this.registers.PC,this.memory),this["[imm8]"]=new J(this.imm8,this.memory),this["[imm16]"]=new H(this.imm16,this.memory),this["[FF00+C]"]=new J(this.registers.C,this.memory,{offset:65280}),this["[FF00+imm8]"]=new J(this.imm8,this.memory,{offset:65280}),this.instructions=ct.loadInstructions(this),this.prefixedInstructions=ct.loadPrefixedInstructions(this)}getImmediate8(){return this.imm8.value}getImmediate16(){return this.imm16.value}getCurrentAddress(){return this.registers.PC.value}goToAddress(t){this.registers.PC.value=t}goToRelativeAddress(t){this.registers.PC.value+=t}goToNextInstruction(t=0){this.goToRelativeAddress(1+t)}execute(t){this.instructions[t].execute(t)}executePrefixed(t){this.prefixedInstructions[t].execute(t)}hardLock(){this.hardLocked=!0}isHardLocked(){return this.hardLocked}loadROM(t){for(const[e,r]of[...t].entries())this.memory.addresses[e]=r}startDispatchLoop(){setInterval(()=&gt;{this.dispatch()},1e3/60)}dispatch(){const t=this.decode(this.fetchNextByte()),e=this.instructions[t];return console.log(`Executing opcode : ${t.toString(16).toUpperCase()} | ${t.toString(2)} | ${e.toString(t)}`),e.execute(t),e}fetchNextByte(){const t=this.memory.addresses[this.registers.PC.value];return console.log(`Fetching byte : ${t.toString(16).toUpperCase()} | ${t.toString(2)}`),t}decode(t){const e=t;if(!this.isValidOpcode(e))throw new Error(`Unknown instruction ${e.toString(16).toUpperCase()} | ${e.toString(2)}`);return e}isValidOpcode(t){return this.instructions[t]}decodePrefixed(t){const e=t;if(!Object.keys(this.prefixedInstructions).includes(String(e)))throw new Error("Unknown prefixed instruction");return e}}l.AbstractRegister=at,l.C=ft,l.COLOR_DEPTH=St,l.ComposedRegister=z,l.Condition=K,l.Cpu=gs,l.Graphics=Kt,l.HLD=vt,l.HLI=It,l.Immediate16=wt,l.Immediate8=xt,l.ImmediateMemoryValue=rt,l.Instruction=c,l.Memory=zt,l.Memory16Value=nt,l.Memory8Value=G,l.MemoryValue=it,l.NC=Tt,l.NZ=Ct,l.OperationFlags=yt,l.Pointed16Value=H,l.Pointed8Value=J,l.Register16=k,l.Register8=y,l.Registers=Xt,l.SKIP_IMMEDIATE_16=C,l.SKIP_IMMEDIATE_8=Z,l.TILE_DATA_BYTE_SIZE=ot,l.TILE_DATA_WIDTH=W,l.TileData=At,l.TileDataTable=Ft,l.Z=Rt,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}</span></span>)});</span>
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-03-09T20:59:11.692Z
            </div>
        <script src="../../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../../sorter.js"></script>
        <script src="../../../block-navigation.js"></script>
    </body>
</html>
    